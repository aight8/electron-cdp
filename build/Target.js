"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * Supports additional targets discovery and allows to attach to them.
 * @experimental
 */
class Target {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create Target Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** Controls whether to discover available targets and notify via <code>targetCreated/targetDestroyed</code> events. */
    async setDiscoverTargets(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.setDiscoverTargets', params, (error, result) => {
                this.assertError(error, 'Target.setDiscoverTargets');
                resolve();
            });
        });
    }
    /** Controls whether to automatically attach to new targets which are considered to be related to this one. When turned on, attaches to all existing related targets as well. When turned off, automatically detaches from all currently attached targets. */
    async setAutoAttach(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.setAutoAttach', params, (error, result) => {
                this.assertError(error, 'Target.setAutoAttach');
                resolve();
            });
        });
    }
    /** No description */
    async setAttachToFrames(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.setAttachToFrames', params, (error, result) => {
                this.assertError(error, 'Target.setAttachToFrames');
                resolve();
            });
        });
    }
    /** Enables target discovery for the specified locations, when <code>setDiscoverTargets</code> was set to <code>true</code>. */
    async setRemoteLocations(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.setRemoteLocations', params, (error, result) => {
                this.assertError(error, 'Target.setRemoteLocations');
                resolve();
            });
        });
    }
    /** Sends protocol message to the target with given id. */
    async sendMessageToTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.sendMessageToTarget', params, (error, result) => {
                this.assertError(error, 'Target.sendMessageToTarget');
                resolve();
            });
        });
    }
    /** Returns information about a target. */
    async getTargetInfo(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.getTargetInfo', params, (error, result) => {
                this.assertError(error, 'Target.getTargetInfo');
                resolve(result);
            });
        });
    }
    /** Activates (focuses) the target. */
    async activateTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.activateTarget', params, (error, result) => {
                this.assertError(error, 'Target.activateTarget');
                resolve();
            });
        });
    }
    /** Closes the target. If the target is a page that gets closed too. */
    async closeTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.closeTarget', params, (error, result) => {
                this.assertError(error, 'Target.closeTarget');
                resolve(result);
            });
        });
    }
    /** Attaches to the target with given id. */
    async attachToTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.attachToTarget', params, (error, result) => {
                this.assertError(error, 'Target.attachToTarget');
                resolve(result);
            });
        });
    }
    /** Detaches from the target with given id. */
    async detachFromTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.detachFromTarget', params, (error, result) => {
                this.assertError(error, 'Target.detachFromTarget');
                resolve();
            });
        });
    }
    /** Creates a new empty BrowserContext. Similar to an incognito profile but you can have more than one. */
    async createBrowserContext() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.createBrowserContext', {}, (error, result) => {
                this.assertError(error, 'Target.createBrowserContext');
                resolve(result);
            });
        });
    }
    /** Deletes a BrowserContext, will fail of any open page uses it. */
    async disposeBrowserContext(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.disposeBrowserContext', params, (error, result) => {
                this.assertError(error, 'Target.disposeBrowserContext');
                resolve(result);
            });
        });
    }
    /** Creates a new page. */
    async createTarget(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.createTarget', params, (error, result) => {
                this.assertError(error, 'Target.createTarget');
                resolve(result);
            });
        });
    }
    /** Retrieves a list of available targets. */
    async getTargets() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Target.getTargets', {}, (error, result) => {
                this.assertError(error, 'Target.getTargets');
                resolve(result);
            });
        });
    }
}
exports.default = Target;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGFyZ2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vZ2VuZXJhdGVkLXRzL1RhcmdldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFzQztBQUN0QyxtREFBMkM7QUErUTNDOzs7R0FHRztBQUNIO0lBR0ksWUFBNkIsR0FBUSxDQUFDLHNCQUFzQjtRQUEvQixRQUFHLEdBQUgsR0FBRyxDQUFLLENBQUMsc0JBQXNCO1FBRnBELFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO1FBSS9CLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVztZQUN4RCxNQUFNLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzFDLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLHlFQUF5RSxDQUFDLENBQUE7UUFDOUYsQ0FBQztJQUNMLENBQUM7SUFFTSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU0sSUFBSSxDQUFDLEtBQWEsRUFBRSxRQUFrQjtRQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVPLFdBQVcsQ0FBQyxLQUFVLEVBQUUsV0FBbUI7UUFDL0MsRUFBRSxDQUFDLENBQUMsU0FBUyxJQUFJLEtBQUss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QSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnXG5pbXBvcnQgRGVidWdnZXJFcnJvciBmcm9tICcuL0RlYnVnZ2VyRXJyb3InXG5cbmRlY2xhcmUgaW50ZXJmYWNlIFRhcmdldCB7XG5cbiAgICAvKiogSXNzdWVkIHdoZW4gYSBwb3NzaWJsZSBpbnNwZWN0aW9uIHRhcmdldCBpcyBjcmVhdGVkLiAqL1xuICAgIG9uKGV2ZW50OiAndGFyZ2V0Q3JlYXRlZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBUYXJnZXQuRXZlbnRQYXJhbXMudGFyZ2V0Q3JlYXRlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogSXNzdWVkIHdoZW4gYSBwb3NzaWJsZSBpbnNwZWN0aW9uIHRhcmdldCBpcyBjcmVhdGVkLiAqL1xuICAgIG9uY2UoZXZlbnQ6ICd0YXJnZXRDcmVhdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IFRhcmdldC5FdmVudFBhcmFtcy50YXJnZXRDcmVhdGVkKSA9PiB2b2lkKTogdm9pZFxuXG4gICAgLyoqIElzc3VlZCB3aGVuIGEgdGFyZ2V0IGlzIGRlc3Ryb3llZC4gKi9cbiAgICBvbihldmVudDogJ3RhcmdldERlc3Ryb3llZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBUYXJnZXQuRXZlbnRQYXJhbXMudGFyZ2V0RGVzdHJveWVkKSA9PiB2b2lkKTogdm9pZFxuICAgIC8qKiBJc3N1ZWQgd2hlbiBhIHRhcmdldCBpcyBkZXN0cm95ZWQuICovXG4gICAgb25jZShldmVudDogJ3RhcmdldERlc3Ryb3llZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBUYXJnZXQuRXZlbnRQYXJhbXMudGFyZ2V0RGVzdHJveWVkKSA9PiB2b2lkKTogdm9pZFxuXG4gICAgLyoqIElzc3VlZCB3aGVuIGF0dGFjaGVkIHRvIHRhcmdldCBiZWNhdXNlIG9mIGF1dG8tYXR0YWNoIG9yIDxjb2RlPmF0dGFjaFRvVGFyZ2V0PC9jb2RlPiBjb21tYW5kLiAqL1xuICAgIG9uKGV2ZW50OiAnYXR0YWNoZWRUb1RhcmdldCcsIGxpc3RlbmVyOiAocGFyYW1zOiBUYXJnZXQuRXZlbnRQYXJhbXMuYXR0YWNoZWRUb1RhcmdldCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogSXNzdWVkIHdoZW4gYXR0YWNoZWQgdG8gdGFyZ2V0IGJlY2F1c2Ugb2YgYXV0by1hdHRhY2ggb3IgPGNvZGU+YXR0YWNoVG9UYXJnZXQ8L2NvZGU+IGNvbW1hbmQuICovXG4gICAgb25jZShldmVudDogJ2F0dGFjaGVkVG9UYXJnZXQnLCBsaXN0ZW5lcjogKHBhcmFtczogVGFyZ2V0LkV2ZW50UGFyYW1zLmF0dGFjaGVkVG9UYXJnZXQpID0+IHZvaWQpOiB2b2lkXG5cbiAgICAvKiogSXNzdWVkIHdoZW4gZGV0YWNoZWQgZnJvbSB0YXJnZXQgZm9yIGFueSByZWFzb24gKGluY2x1ZGluZyA8Y29kZT5kZXRhY2hGcm9tVGFyZ2V0PC9jb2RlPiBjb21tYW5kKS4gKi9cbiAgICBvbihldmVudDogJ2RldGFjaGVkRnJvbVRhcmdldCcsIGxpc3RlbmVyOiAocGFyYW1zOiBUYXJnZXQuRXZlbnRQYXJhbXMuZGV0YWNoZWRGcm9tVGFyZ2V0KSA9PiB2b2lkKTogdm9pZFxuICAgIC8qKiBJc3N1ZWQgd2hlbiBkZXRhY2hlZCBmcm9tIHRhcmdldCBmb3IgYW55IHJlYXNvbiAoaW5jbHVkaW5nIDxjb2RlPmRldGFjaEZyb21UYXJnZXQ8L2NvZGU+IGNvbW1hbmQpLiAqL1xuICAgIG9uY2UoZXZlbnQ6ICdkZXRhY2hlZEZyb21UYXJnZXQnLCBsaXN0ZW5lcjogKHBhcmFtczogVGFyZ2V0LkV2ZW50UGFyYW1zLmRldGFjaGVkRnJvbVRhcmdldCkgPT4gdm9pZCk6IHZvaWRcblxuICAgIC8qKiBOb3RpZmllcyBhYm91dCBuZXcgcHJvdG9jb2wgbWVzc2FnZSBmcm9tIGF0dGFjaGVkIHRhcmdldC4gKi9cbiAgICBvbihldmVudDogJ3JlY2VpdmVkTWVzc2FnZUZyb21UYXJnZXQnLCBsaXN0ZW5lcjogKHBhcmFtczogVGFyZ2V0LkV2ZW50UGFyYW1zLnJlY2VpdmVkTWVzc2FnZUZyb21UYXJnZXQpID0+IHZvaWQpOiB2b2lkXG4gICAgLyoqIE5vdGlmaWVzIGFib3V0IG5ldyBwcm90b2NvbCBtZXNzYWdlIGZyb20gYXR0YWNoZWQgdGFyZ2V0LiAqL1xuICAgIG9uY2UoZXZlbnQ6ICdyZWNlaXZlZE1lc3NhZ2VGcm9tVGFyZ2V0JywgbGlzdGVuZXI6IChwYXJhbXM6IFRhcmdldC5FdmVudFBhcmFtcy5yZWNlaXZlZE1lc3NhZ2VGcm9tVGFyZ2V0KSA9PiB2b2lkKTogdm9pZFxuXG59XG5cbm1vZHVsZSBUYXJnZXQge1xuICAgIC8qKioqKioqKioqKioqKipcbiAgICAgKioqKiBUeXBlcyAqKioqXG4gICAgICoqKioqKioqKioqKioqL1xuXG4gICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICBleHBvcnQgdHlwZSBUYXJnZXRJRCA9IHN0cmluZ1xuXG4gICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICBleHBvcnQgdHlwZSBCcm93c2VyQ29udGV4dElEID0gc3RyaW5nXG5cbiAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgIGV4cG9ydCB0eXBlIFRhcmdldEluZm8gPSB7XG4gICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICB0YXJnZXRJZDogVGFyZ2V0SURcblxuICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgdHlwZTogc3RyaW5nXG5cbiAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgIHRpdGxlOiBzdHJpbmdcblxuICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgdXJsOiBzdHJpbmdcbiAgICB9XG5cbiAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgIGV4cG9ydCB0eXBlIFJlbW90ZUxvY2F0aW9uID0ge1xuICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgaG9zdDogc3RyaW5nXG5cbiAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgIHBvcnQ6IG51bWJlclxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgc2V0RGlzY292ZXJUYXJnZXRzID0ge1xuICAgICAgICAgICAgLyoqIFdoZXRoZXIgdG8gZGlzY292ZXIgYXZhaWxhYmxlIHRhcmdldHMuICovXG4gICAgICAgICAgICBkaXNjb3ZlcjogYm9vbGVhblxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgc2V0QXV0b0F0dGFjaCA9IHtcbiAgICAgICAgICAgIC8qKiBXaGV0aGVyIHRvIGF1dG8tYXR0YWNoIHRvIHJlbGF0ZWQgdGFyZ2V0cy4gKi9cbiAgICAgICAgICAgIGF1dG9BdHRhY2g6IGJvb2xlYW5cblxuICAgICAgICAgICAgLyoqIFdoZXRoZXIgdG8gcGF1c2UgbmV3IHRhcmdldHMgd2hlbiBhdHRhY2hpbmcgdG8gdGhlbS4gVXNlIDxjb2RlPlJ1bnRpbWUucnVuSWZXYWl0aW5nRm9yRGVidWdnZXI8L2NvZGU+IHRvIHJ1biBwYXVzZWQgdGFyZ2V0cy4gKi9cbiAgICAgICAgICAgIHdhaXRGb3JEZWJ1Z2dlck9uU3RhcnQ6IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHNldEF0dGFjaFRvRnJhbWVzID0ge1xuICAgICAgICAgICAgLyoqIFdoZXRoZXIgdG8gYXR0YWNoIHRvIGZyYW1lcy4gKi9cbiAgICAgICAgICAgIHZhbHVlOiBib29sZWFuXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzZXRSZW1vdGVMb2NhdGlvbnMgPSB7XG4gICAgICAgICAgICAvKiogTGlzdCBvZiByZW1vdGUgbG9jYXRpb25zLiAqL1xuICAgICAgICAgICAgbG9jYXRpb25zOiBSZW1vdGVMb2NhdGlvbltdXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzZW5kTWVzc2FnZVRvVGFyZ2V0ID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB0YXJnZXRJZDogVGFyZ2V0SURcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBtZXNzYWdlOiBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGdldFRhcmdldEluZm8gPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgYWN0aXZhdGVUYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgY2xvc2VUYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgYXR0YWNoVG9UYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZGV0YWNoRnJvbVRhcmdldCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgdGFyZ2V0SWQ6IFRhcmdldElEXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBkaXNwb3NlQnJvd3NlckNvbnRleHQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIGJyb3dzZXJDb250ZXh0SWQ6IEJyb3dzZXJDb250ZXh0SURcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGNyZWF0ZVRhcmdldCA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgaW5pdGlhbCBVUkwgdGhlIHBhZ2Ugd2lsbCBiZSBuYXZpZ2F0ZWQgdG8uICovXG4gICAgICAgICAgICB1cmw6IHN0cmluZ1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEZyYW1lIHdpZHRoIGluIERJUCAoaGVhZGxlc3MgY2hyb21lIG9ubHkpLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHdpZHRoPzogbnVtYmVyXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogRnJhbWUgaGVpZ2h0IGluIERJUCAoaGVhZGxlc3MgY2hyb21lIG9ubHkpLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGhlaWdodD86IG51bWJlclxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBicm93c2VyIGNvbnRleHQgdG8gY3JlYXRlIHRoZSBwYWdlIGluIChoZWFkbGVzcyBjaHJvbWUgb25seSkuXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgYnJvd3NlckNvbnRleHRJZD86IEJyb3dzZXJDb250ZXh0SURcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgKioqKiBDb21tYW5kIFJlc3VsdCAqKioqXG4gICAgICoqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUmVzdWx0IHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZ2V0VGFyZ2V0SW5mbyA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgdGFyZ2V0SW5mbzogVGFyZ2V0SW5mb1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgY2xvc2VUYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGF0dGFjaFRvVGFyZ2V0ID0ge1xuICAgICAgICAgICAgLyoqIFdoZXRoZXIgYXR0YWNoIHN1Y2NlZWRlZC4gKi9cbiAgICAgICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGNyZWF0ZUJyb3dzZXJDb250ZXh0ID0ge1xuICAgICAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgY29udGV4dCBjcmVhdGVkLiAqL1xuICAgICAgICAgICAgYnJvd3NlckNvbnRleHRJZDogQnJvd3NlckNvbnRleHRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZGlzcG9zZUJyb3dzZXJDb250ZXh0ID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBzdWNjZXNzOiBib29sZWFuXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBjcmVhdGVUYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBwYWdlIG9wZW5lZC4gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZ2V0VGFyZ2V0cyA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgbGlzdCBvZiB0YXJnZXRzLiAqL1xuICAgICAgICAgICAgdGFyZ2V0SW5mb3M6IFRhcmdldEluZm9bXVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogRXZlbnQgUGFyYW1ldGVycyAqKioqXG4gICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgZXhwb3J0IG1vZHVsZSBFdmVudFBhcmFtcyB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJc3N1ZWQgd2hlbiBhIHBvc3NpYmxlIGluc3BlY3Rpb24gdGFyZ2V0IGlzIGNyZWF0ZWQuXG4gICAgICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgICAgICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHRhcmdldENyZWF0ZWQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldEluZm86IFRhcmdldEluZm9cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJc3N1ZWQgd2hlbiBhIHRhcmdldCBpcyBkZXN0cm95ZWQuXG4gICAgICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgICAgICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHRhcmdldERlc3Ryb3llZCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgdGFyZ2V0SWQ6IFRhcmdldElEXG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSXNzdWVkIHdoZW4gYXR0YWNoZWQgdG8gdGFyZ2V0IGJlY2F1c2Ugb2YgYXV0by1hdHRhY2ggb3IgPGNvZGU+YXR0YWNoVG9UYXJnZXQ8L2NvZGU+IGNvbW1hbmQuXG4gICAgICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgICAgICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGF0dGFjaGVkVG9UYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldEluZm86IFRhcmdldEluZm9cblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB3YWl0aW5nRm9yRGVidWdnZXI6IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJc3N1ZWQgd2hlbiBkZXRhY2hlZCBmcm9tIHRhcmdldCBmb3IgYW55IHJlYXNvbiAoaW5jbHVkaW5nIDxjb2RlPmRldGFjaEZyb21UYXJnZXQ8L2NvZGU+IGNvbW1hbmQpLlxuICAgICAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnQgdHlwZSBkZXRhY2hlZEZyb21UYXJnZXQgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHRhcmdldElkOiBUYXJnZXRJRFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE5vdGlmaWVzIGFib3V0IG5ldyBwcm90b2NvbCBtZXNzYWdlIGZyb20gYXR0YWNoZWQgdGFyZ2V0LlxuICAgICAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnQgdHlwZSByZWNlaXZlZE1lc3NhZ2VGcm9tVGFyZ2V0ID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB0YXJnZXRJZDogVGFyZ2V0SURcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBtZXNzYWdlOiBzdHJpbmdcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBTdXBwb3J0cyBhZGRpdGlvbmFsIHRhcmdldHMgZGlzY292ZXJ5IGFuZCBhbGxvd3MgdG8gYXR0YWNoIHRvIHRoZW0uXG4gKiBAZXhwZXJpbWVudGFsXG4gKi9cbmNsYXNzIFRhcmdldCB7XG4gICAgcHJpdmF0ZSBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKClcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZGJnOiBhbnkgLyogRWxlY3Ryb24uRGVidWdnZXIqLyApIHtcblxuICAgICAgICB0aGlzLmRiZy5vbignbWVzc2FnZScsIChldmVudDogYW55LCBtZXRob2Q6IGFueSwgcGFyYW1zOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtkb21haW4sIGRvbWFpbk1ldGhvZF0gPSBtZXRob2Quc3BsaXQoJy4nKVxuICAgICAgICAgICAgdGhpcy5ldmVudHMuZW1pdChkb21haW5NZXRob2QsIHBhcmFtcylcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXRoaXMuZGJnLmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIFRhcmdldCBEb21haW4gQ2xhc3MgYmVjYXVzZSB0aGUgZGVidWdnZXIgaXMgbm90IGF0dGFjaGVkLmApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb24oZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKGV2ZW50LCBsaXN0ZW5lcilcbiAgICB9XG5cbiAgICBwdWJsaWMgb25jZShldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5ldmVudHMub24oZXZlbnQsIGxpc3RlbmVyKVxuICAgIH1cblxuICAgIHByaXZhdGUgYXNzZXJ0RXJyb3IoZXJyb3I6IGFueSwgY29tbWFuZE5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoJ21lc3NhZ2UnIGluIGVycm9yICYmICdjb2RlJyBpbiBlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IERlYnVnZ2VyRXJyb3IoZXJyb3IubWVzc2FnZSwgZXJyb3IuY29kZSwgY29tbWFuZE5hbWUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQ29udHJvbHMgd2hldGhlciB0byBkaXNjb3ZlciBhdmFpbGFibGUgdGFyZ2V0cyBhbmQgbm90aWZ5IHZpYSA8Y29kZT50YXJnZXRDcmVhdGVkL3RhcmdldERlc3Ryb3llZDwvY29kZT4gZXZlbnRzLiAqL1xuICAgIHB1YmxpYyBhc3luYyBzZXREaXNjb3ZlclRhcmdldHMocGFyYW1zOiBUYXJnZXQuUGFyYW1zLnNldERpc2NvdmVyVGFyZ2V0cyk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RhcmdldC5zZXREaXNjb3ZlclRhcmdldHMnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUYXJnZXQuc2V0RGlzY292ZXJUYXJnZXRzJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIENvbnRyb2xzIHdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBhdHRhY2ggdG8gbmV3IHRhcmdldHMgd2hpY2ggYXJlIGNvbnNpZGVyZWQgdG8gYmUgcmVsYXRlZCB0byB0aGlzIG9uZS4gV2hlbiB0dXJuZWQgb24sIGF0dGFjaGVzIHRvIGFsbCBleGlzdGluZyByZWxhdGVkIHRhcmdldHMgYXMgd2VsbC4gV2hlbiB0dXJuZWQgb2ZmLCBhdXRvbWF0aWNhbGx5IGRldGFjaGVzIGZyb20gYWxsIGN1cnJlbnRseSBhdHRhY2hlZCB0YXJnZXRzLiAqL1xuICAgIHB1YmxpYyBhc3luYyBzZXRBdXRvQXR0YWNoKHBhcmFtczogVGFyZ2V0LlBhcmFtcy5zZXRBdXRvQXR0YWNoKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVGFyZ2V0LnNldEF1dG9BdHRhY2gnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUYXJnZXQuc2V0QXV0b0F0dGFjaCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBzZXRBdHRhY2hUb0ZyYW1lcyhwYXJhbXM6IFRhcmdldC5QYXJhbXMuc2V0QXR0YWNoVG9GcmFtZXMpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUYXJnZXQuc2V0QXR0YWNoVG9GcmFtZXMnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUYXJnZXQuc2V0QXR0YWNoVG9GcmFtZXMnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogRW5hYmxlcyB0YXJnZXQgZGlzY292ZXJ5IGZvciB0aGUgc3BlY2lmaWVkIGxvY2F0aW9ucywgd2hlbiA8Y29kZT5zZXREaXNjb3ZlclRhcmdldHM8L2NvZGU+IHdhcyBzZXQgdG8gPGNvZGU+dHJ1ZTwvY29kZT4uICovXG4gICAgcHVibGljIGFzeW5jIHNldFJlbW90ZUxvY2F0aW9ucyhwYXJhbXM6IFRhcmdldC5QYXJhbXMuc2V0UmVtb3RlTG9jYXRpb25zKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVGFyZ2V0LnNldFJlbW90ZUxvY2F0aW9ucycsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5zZXRSZW1vdGVMb2NhdGlvbnMnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogU2VuZHMgcHJvdG9jb2wgbWVzc2FnZSB0byB0aGUgdGFyZ2V0IHdpdGggZ2l2ZW4gaWQuICovXG4gICAgcHVibGljIGFzeW5jIHNlbmRNZXNzYWdlVG9UYXJnZXQocGFyYW1zOiBUYXJnZXQuUGFyYW1zLnNlbmRNZXNzYWdlVG9UYXJnZXQpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUYXJnZXQuc2VuZE1lc3NhZ2VUb1RhcmdldCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5zZW5kTWVzc2FnZVRvVGFyZ2V0JylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIFJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQgYSB0YXJnZXQuICovXG4gICAgcHVibGljIGFzeW5jIGdldFRhcmdldEluZm8ocGFyYW1zOiBUYXJnZXQuUGFyYW1zLmdldFRhcmdldEluZm8pOiBQcm9taXNlPFRhcmdldC5SZXN1bHQuZ2V0VGFyZ2V0SW5mbz57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxUYXJnZXQuUmVzdWx0LmdldFRhcmdldEluZm8+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUYXJnZXQuZ2V0VGFyZ2V0SW5mbycsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5nZXRUYXJnZXRJbmZvJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCBhcyBUYXJnZXQuUmVzdWx0LmdldFRhcmdldEluZm8pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBBY3RpdmF0ZXMgKGZvY3VzZXMpIHRoZSB0YXJnZXQuICovXG4gICAgcHVibGljIGFzeW5jIGFjdGl2YXRlVGFyZ2V0KHBhcmFtczogVGFyZ2V0LlBhcmFtcy5hY3RpdmF0ZVRhcmdldCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RhcmdldC5hY3RpdmF0ZVRhcmdldCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5hY3RpdmF0ZVRhcmdldCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBDbG9zZXMgdGhlIHRhcmdldC4gSWYgdGhlIHRhcmdldCBpcyBhIHBhZ2UgdGhhdCBnZXRzIGNsb3NlZCB0b28uICovXG4gICAgcHVibGljIGFzeW5jIGNsb3NlVGFyZ2V0KHBhcmFtczogVGFyZ2V0LlBhcmFtcy5jbG9zZVRhcmdldCk6IFByb21pc2U8VGFyZ2V0LlJlc3VsdC5jbG9zZVRhcmdldD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxUYXJnZXQuUmVzdWx0LmNsb3NlVGFyZ2V0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVGFyZ2V0LmNsb3NlVGFyZ2V0JywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVGFyZ2V0LmNsb3NlVGFyZ2V0JylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCBhcyBUYXJnZXQuUmVzdWx0LmNsb3NlVGFyZ2V0KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogQXR0YWNoZXMgdG8gdGhlIHRhcmdldCB3aXRoIGdpdmVuIGlkLiAqL1xuICAgIHB1YmxpYyBhc3luYyBhdHRhY2hUb1RhcmdldChwYXJhbXM6IFRhcmdldC5QYXJhbXMuYXR0YWNoVG9UYXJnZXQpOiBQcm9taXNlPFRhcmdldC5SZXN1bHQuYXR0YWNoVG9UYXJnZXQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8VGFyZ2V0LlJlc3VsdC5hdHRhY2hUb1RhcmdldD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RhcmdldC5hdHRhY2hUb1RhcmdldCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5hdHRhY2hUb1RhcmdldCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgVGFyZ2V0LlJlc3VsdC5hdHRhY2hUb1RhcmdldClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIERldGFjaGVzIGZyb20gdGhlIHRhcmdldCB3aXRoIGdpdmVuIGlkLiAqL1xuICAgIHB1YmxpYyBhc3luYyBkZXRhY2hGcm9tVGFyZ2V0KHBhcmFtczogVGFyZ2V0LlBhcmFtcy5kZXRhY2hGcm9tVGFyZ2V0KTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVGFyZ2V0LmRldGFjaEZyb21UYXJnZXQnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUYXJnZXQuZGV0YWNoRnJvbVRhcmdldCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IGVtcHR5IEJyb3dzZXJDb250ZXh0LiBTaW1pbGFyIHRvIGFuIGluY29nbml0byBwcm9maWxlIGJ1dCB5b3UgY2FuIGhhdmUgbW9yZSB0aGFuIG9uZS4gKi9cbiAgICBwdWJsaWMgYXN5bmMgY3JlYXRlQnJvd3NlckNvbnRleHQoKTogUHJvbWlzZTxUYXJnZXQuUmVzdWx0LmNyZWF0ZUJyb3dzZXJDb250ZXh0PntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFRhcmdldC5SZXN1bHQuY3JlYXRlQnJvd3NlckNvbnRleHQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUYXJnZXQuY3JlYXRlQnJvd3NlckNvbnRleHQnLCB7fSwgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5jcmVhdGVCcm93c2VyQ29udGV4dCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgVGFyZ2V0LlJlc3VsdC5jcmVhdGVCcm93c2VyQ29udGV4dClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIERlbGV0ZXMgYSBCcm93c2VyQ29udGV4dCwgd2lsbCBmYWlsIG9mIGFueSBvcGVuIHBhZ2UgdXNlcyBpdC4gKi9cbiAgICBwdWJsaWMgYXN5bmMgZGlzcG9zZUJyb3dzZXJDb250ZXh0KHBhcmFtczogVGFyZ2V0LlBhcmFtcy5kaXNwb3NlQnJvd3NlckNvbnRleHQpOiBQcm9taXNlPFRhcmdldC5SZXN1bHQuZGlzcG9zZUJyb3dzZXJDb250ZXh0PntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFRhcmdldC5SZXN1bHQuZGlzcG9zZUJyb3dzZXJDb250ZXh0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVGFyZ2V0LmRpc3Bvc2VCcm93c2VyQ29udGV4dCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ1RhcmdldC5kaXNwb3NlQnJvd3NlckNvbnRleHQnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0IGFzIFRhcmdldC5SZXN1bHQuZGlzcG9zZUJyb3dzZXJDb250ZXh0KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBwYWdlLiAqL1xuICAgIHB1YmxpYyBhc3luYyBjcmVhdGVUYXJnZXQocGFyYW1zOiBUYXJnZXQuUGFyYW1zLmNyZWF0ZVRhcmdldCk6IFByb21pc2U8VGFyZ2V0LlJlc3VsdC5jcmVhdGVUYXJnZXQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8VGFyZ2V0LlJlc3VsdC5jcmVhdGVUYXJnZXQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUYXJnZXQuY3JlYXRlVGFyZ2V0JywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVGFyZ2V0LmNyZWF0ZVRhcmdldCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgVGFyZ2V0LlJlc3VsdC5jcmVhdGVUYXJnZXQpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZXRyaWV2ZXMgYSBsaXN0IG9mIGF2YWlsYWJsZSB0YXJnZXRzLiAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRUYXJnZXRzKCk6IFByb21pc2U8VGFyZ2V0LlJlc3VsdC5nZXRUYXJnZXRzPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFRhcmdldC5SZXN1bHQuZ2V0VGFyZ2V0cz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RhcmdldC5nZXRUYXJnZXRzJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUYXJnZXQuZ2V0VGFyZ2V0cycpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgVGFyZ2V0LlJlc3VsdC5nZXRUYXJnZXRzKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgVGFyZ2V0Il19