"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * No description
 * @experimental
 */
class HeapProfiler {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create HeapProfiler Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** No description */
    async enable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.enable', {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.enable');
                resolve();
            });
        });
    }
    /** No description */
    async disable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.disable', {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.disable');
                resolve();
            });
        });
    }
    /** No description */
    async startTrackingHeapObjects(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.startTrackingHeapObjects', params || {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.startTrackingHeapObjects');
                resolve();
            });
        });
    }
    /** No description */
    async stopTrackingHeapObjects(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.stopTrackingHeapObjects', params || {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.stopTrackingHeapObjects');
                resolve();
            });
        });
    }
    /** No description */
    async takeHeapSnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.takeHeapSnapshot', params || {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.takeHeapSnapshot');
                resolve();
            });
        });
    }
    /** No description */
    async collectGarbage() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.collectGarbage', {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.collectGarbage');
                resolve();
            });
        });
    }
    /** No description */
    async getObjectByHeapObjectId(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.getObjectByHeapObjectId', params, (error, result) => {
                this.assertError(error, 'HeapProfiler.getObjectByHeapObjectId');
                resolve(result);
            });
        });
    }
    /** Enables console to refer to the node with given id via $x (see Command Line API for more details $x functions). */
    async addInspectedHeapObject(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.addInspectedHeapObject', params, (error, result) => {
                this.assertError(error, 'HeapProfiler.addInspectedHeapObject');
                resolve();
            });
        });
    }
    /** No description */
    async getHeapObjectId(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.getHeapObjectId', params, (error, result) => {
                this.assertError(error, 'HeapProfiler.getHeapObjectId');
                resolve(result);
            });
        });
    }
    /** No description */
    async startSampling(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.startSampling', params || {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.startSampling');
                resolve();
            });
        });
    }
    /** No description */
    async stopSampling() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('HeapProfiler.stopSampling', {}, (error, result) => {
                this.assertError(error, 'HeapProfiler.stopSampling');
                resolve(result);
            });
        });
    }
}
exports.default = HeapProfiler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSGVhcFByb2ZpbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vZ2VuZXJhdGVkLXRzL0hlYXBQcm9maWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFzQztBQUN0QyxtREFBMkM7QUEyTTNDOzs7R0FHRztBQUNIO0lBR0ksWUFBNkIsR0FBUSxDQUFDLHNCQUFzQjtRQUEvQixRQUFHLEdBQUgsR0FBRyxDQUFLLENBQUMsc0JBQXNCO1FBRnBELFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO1FBSS9CLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVztZQUN4RCxNQUFNLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzFDLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLCtFQUErRSxDQUFDLENBQUE7UUFDcEcsQ0FBQztJQUNMLENBQUM7SUFFTSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU0sSUFBSSxDQUFDLEtBQWEsRUFBRSxRQUFrQjtRQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVPLFdBQVcsQ0FBQyxLQUFVLEVBQUUsV0FBbUI7UUFDL0MsRUFBRSxDQUFDLENBQUMsU0FB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cm9tICdldmVudHMnXG5pbXBvcnQgRGVidWdnZXJFcnJvciBmcm9tICcuL0RlYnVnZ2VyRXJyb3InXG5pbXBvcnQgUnVudGltZSBmcm9tICcuL1J1bnRpbWUnXG5cbmRlY2xhcmUgaW50ZXJmYWNlIEhlYXBQcm9maWxlciB7XG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbihldmVudDogJ2FkZEhlYXBTbmFwc2hvdENodW5rJywgbGlzdGVuZXI6IChwYXJhbXM6IEhlYXBQcm9maWxlci5FdmVudFBhcmFtcy5hZGRIZWFwU25hcHNob3RDaHVuaykgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnYWRkSGVhcFNuYXBzaG90Q2h1bmsnLCBsaXN0ZW5lcjogKHBhcmFtczogSGVhcFByb2ZpbGVyLkV2ZW50UGFyYW1zLmFkZEhlYXBTbmFwc2hvdENodW5rKSA9PiB2b2lkKTogdm9pZFxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb24oZXZlbnQ6ICdyZXNldFByb2ZpbGVzJywgbGlzdGVuZXI6ICgpID0+IHZvaWQpOiB2b2lkXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb25jZShldmVudDogJ3Jlc2V0UHJvZmlsZXMnLCBsaXN0ZW5lcjogKCkgPT4gdm9pZCk6IHZvaWRcblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIG9uKGV2ZW50OiAncmVwb3J0SGVhcFNuYXBzaG90UHJvZ3Jlc3MnLCBsaXN0ZW5lcjogKHBhcmFtczogSGVhcFByb2ZpbGVyLkV2ZW50UGFyYW1zLnJlcG9ydEhlYXBTbmFwc2hvdFByb2dyZXNzKSA9PiB2b2lkKTogdm9pZFxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIG9uY2UoZXZlbnQ6ICdyZXBvcnRIZWFwU25hcHNob3RQcm9ncmVzcycsIGxpc3RlbmVyOiAocGFyYW1zOiBIZWFwUHJvZmlsZXIuRXZlbnRQYXJhbXMucmVwb3J0SGVhcFNuYXBzaG90UHJvZ3Jlc3MpID0+IHZvaWQpOiB2b2lkXG5cbiAgICAvKiogSWYgaGVhcCBvYmplY3RzIHRyYWNraW5nIGhhcyBiZWVuIHN0YXJ0ZWQgdGhlbiBiYWNrZW5kIHJlZ3VsYXJseSBzZW5kcyBhIGN1cnJlbnQgdmFsdWUgZm9yIGxhc3Qgc2VlbiBvYmplY3QgaWQgYW5kIGNvcnJlc3BvbmRpbmcgdGltZXN0YW1wLiBJZiB0aGUgd2VyZSBjaGFuZ2VzIGluIHRoZSBoZWFwIHNpbmNlIGxhc3QgZXZlbnQgdGhlbiBvbmUgb3IgbW9yZSBoZWFwU3RhdHNVcGRhdGUgZXZlbnRzIHdpbGwgYmUgc2VudCBiZWZvcmUgYSBuZXcgbGFzdFNlZW5PYmplY3RJZCBldmVudC4gKi9cbiAgICBvbihldmVudDogJ2xhc3RTZWVuT2JqZWN0SWQnLCBsaXN0ZW5lcjogKHBhcmFtczogSGVhcFByb2ZpbGVyLkV2ZW50UGFyYW1zLmxhc3RTZWVuT2JqZWN0SWQpID0+IHZvaWQpOiB2b2lkXG4gICAgLyoqIElmIGhlYXAgb2JqZWN0cyB0cmFja2luZyBoYXMgYmVlbiBzdGFydGVkIHRoZW4gYmFja2VuZCByZWd1bGFybHkgc2VuZHMgYSBjdXJyZW50IHZhbHVlIGZvciBsYXN0IHNlZW4gb2JqZWN0IGlkIGFuZCBjb3JyZXNwb25kaW5nIHRpbWVzdGFtcC4gSWYgdGhlIHdlcmUgY2hhbmdlcyBpbiB0aGUgaGVhcCBzaW5jZSBsYXN0IGV2ZW50IHRoZW4gb25lIG9yIG1vcmUgaGVhcFN0YXRzVXBkYXRlIGV2ZW50cyB3aWxsIGJlIHNlbnQgYmVmb3JlIGEgbmV3IGxhc3RTZWVuT2JqZWN0SWQgZXZlbnQuICovXG4gICAgb25jZShldmVudDogJ2xhc3RTZWVuT2JqZWN0SWQnLCBsaXN0ZW5lcjogKHBhcmFtczogSGVhcFByb2ZpbGVyLkV2ZW50UGFyYW1zLmxhc3RTZWVuT2JqZWN0SWQpID0+IHZvaWQpOiB2b2lkXG5cbiAgICAvKiogSWYgaGVhcCBvYmplY3RzIHRyYWNraW5nIGhhcyBiZWVuIHN0YXJ0ZWQgdGhlbiBiYWNrZW5kIG1heSBzZW5kIHVwZGF0ZSBmb3Igb25lIG9yIG1vcmUgZnJhZ21lbnRzICovXG4gICAgb24oZXZlbnQ6ICdoZWFwU3RhdHNVcGRhdGUnLCBsaXN0ZW5lcjogKHBhcmFtczogSGVhcFByb2ZpbGVyLkV2ZW50UGFyYW1zLmhlYXBTdGF0c1VwZGF0ZSkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogSWYgaGVhcCBvYmplY3RzIHRyYWNraW5nIGhhcyBiZWVuIHN0YXJ0ZWQgdGhlbiBiYWNrZW5kIG1heSBzZW5kIHVwZGF0ZSBmb3Igb25lIG9yIG1vcmUgZnJhZ21lbnRzICovXG4gICAgb25jZShldmVudDogJ2hlYXBTdGF0c1VwZGF0ZScsIGxpc3RlbmVyOiAocGFyYW1zOiBIZWFwUHJvZmlsZXIuRXZlbnRQYXJhbXMuaGVhcFN0YXRzVXBkYXRlKSA9PiB2b2lkKTogdm9pZFxuXG59XG5cbm1vZHVsZSBIZWFwUHJvZmlsZXIge1xuICAgIC8qKioqKioqKioqKioqKipcbiAgICAgKioqKiBUeXBlcyAqKioqXG4gICAgICoqKioqKioqKioqKioqL1xuXG4gICAgLyoqXG4gICAgICogSGVhcCBzbmFwc2hvdCBvYmplY3QgaWQuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIEhlYXBTbmFwc2hvdE9iamVjdElkID0gc3RyaW5nXG5cbiAgICAvKipcbiAgICAgKiBTYW1wbGluZyBIZWFwIFByb2ZpbGUgbm9kZS4gSG9sZHMgY2FsbHNpdGUgaW5mb3JtYXRpb24sIGFsbG9jYXRpb24gc3RhdGlzdGljcyBhbmQgY2hpbGQgbm9kZXMuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIFNhbXBsaW5nSGVhcFByb2ZpbGVOb2RlID0ge1xuICAgICAgICAvKiogRnVuY3Rpb24gbG9jYXRpb24uICovXG4gICAgICAgIGNhbGxGcmFtZTogUnVudGltZS5DYWxsRnJhbWVcblxuICAgICAgICAvKiogQWxsb2NhdGlvbnMgc2l6ZSBpbiBieXRlcyBmb3IgdGhlIG5vZGUgZXhjbHVkaW5nIGNoaWxkcmVuLiAqL1xuICAgICAgICBzZWxmU2l6ZTogbnVtYmVyXG5cbiAgICAgICAgLyoqIENoaWxkIG5vZGVzLiAqL1xuICAgICAgICBjaGlsZHJlbjogU2FtcGxpbmdIZWFwUHJvZmlsZU5vZGVbXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb2ZpbGUuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIFNhbXBsaW5nSGVhcFByb2ZpbGUgPSB7XG4gICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICBoZWFkOiBTYW1wbGluZ0hlYXBQcm9maWxlTm9kZVxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgc3RhcnRUcmFja2luZ0hlYXBPYmplY3RzID0ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBObyBkZXNjcmlwdGlvblxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRyYWNrQWxsb2NhdGlvbnM/OiBib29sZWFuXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzdG9wVHJhY2tpbmdIZWFwT2JqZWN0cyA9IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSWYgdHJ1ZSAncmVwb3J0SGVhcFNuYXBzaG90UHJvZ3Jlc3MnIGV2ZW50cyB3aWxsIGJlIGdlbmVyYXRlZCB3aGlsZSBzbmFwc2hvdCBpcyBiZWluZyB0YWtlbiB3aGVuIHRoZSB0cmFja2luZyBpcyBzdG9wcGVkLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzPzogYm9vbGVhblxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgdGFrZUhlYXBTbmFwc2hvdCA9IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogSWYgdHJ1ZSAncmVwb3J0SGVhcFNuYXBzaG90UHJvZ3Jlc3MnIGV2ZW50cyB3aWxsIGJlIGdlbmVyYXRlZCB3aGlsZSBzbmFwc2hvdCBpcyBiZWluZyB0YWtlbi5cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGdldE9iamVjdEJ5SGVhcE9iamVjdElkID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBvYmplY3RJZDogSGVhcFNuYXBzaG90T2JqZWN0SWRcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBTeW1ib2xpYyBncm91cCBuYW1lIHRoYXQgY2FuIGJlIHVzZWQgdG8gcmVsZWFzZSBtdWx0aXBsZSBvYmplY3RzLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG9iamVjdEdyb3VwPzogc3RyaW5nXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBhZGRJbnNwZWN0ZWRIZWFwT2JqZWN0ID0ge1xuICAgICAgICAgICAgLyoqIEhlYXAgc25hcHNob3Qgb2JqZWN0IGlkIHRvIGJlIGFjY2Vzc2libGUgYnkgbWVhbnMgb2YgJHggY29tbWFuZCBsaW5lIEFQSS4gKi9cbiAgICAgICAgICAgIGhlYXBPYmplY3RJZDogSGVhcFNuYXBzaG90T2JqZWN0SWRcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGdldEhlYXBPYmplY3RJZCA9IHtcbiAgICAgICAgICAgIC8qKiBJZGVudGlmaWVyIG9mIHRoZSBvYmplY3QgdG8gZ2V0IGhlYXAgb2JqZWN0IGlkIGZvci4gKi9cbiAgICAgICAgICAgIG9iamVjdElkOiBSdW50aW1lLlJlbW90ZU9iamVjdElkXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzdGFydFNhbXBsaW5nID0ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBBdmVyYWdlIHNhbXBsZSBpbnRlcnZhbCBpbiBieXRlcy4gUG9pc3NvbiBkaXN0cmlidXRpb24gaXMgdXNlZCBmb3IgdGhlIGludGVydmFscy4gVGhlIGRlZmF1bHQgdmFsdWUgaXMgMzI3NjggYnl0ZXMuXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgc2FtcGxpbmdJbnRlcnZhbD86IG51bWJlclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqKioqIENvbW1hbmQgUmVzdWx0ICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgZXhwb3J0IG1vZHVsZSBSZXN1bHQge1xuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBnZXRPYmplY3RCeUhlYXBPYmplY3RJZCA9IHtcbiAgICAgICAgICAgIC8qKiBFdmFsdWF0aW9uIHJlc3VsdC4gKi9cbiAgICAgICAgICAgIHJlc3VsdDogUnVudGltZS5SZW1vdGVPYmplY3RcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGdldEhlYXBPYmplY3RJZCA9IHtcbiAgICAgICAgICAgIC8qKiBJZCBvZiB0aGUgaGVhcCBzbmFwc2hvdCBvYmplY3QgY29ycmVzcG9uZGluZyB0byB0aGUgcGFzc2VkIHJlbW90ZSBvYmplY3QgaWQuICovXG4gICAgICAgICAgICBoZWFwU25hcHNob3RPYmplY3RJZDogSGVhcFNuYXBzaG90T2JqZWN0SWRcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHN0b3BTYW1wbGluZyA9IHtcbiAgICAgICAgICAgIC8qKiBSZWNvcmRlZCBzYW1wbGluZyBoZWFwIHByb2ZpbGUuICovXG4gICAgICAgICAgICBwcm9maWxlOiBTYW1wbGluZ0hlYXBQcm9maWxlXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgKioqKiBFdmVudCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICBleHBvcnQgbW9kdWxlIEV2ZW50UGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgYWRkSGVhcFNuYXBzaG90Q2h1bmsgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIGNodW5rOiBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHJlcG9ydEhlYXBTbmFwc2hvdFByb2dyZXNzID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBkb25lOiBudW1iZXJcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB0b3RhbDogbnVtYmVyXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogTm8gZGVzY3JpcHRpb25cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmaW5pc2hlZD86IGJvb2xlYW5cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJZiBoZWFwIG9iamVjdHMgdHJhY2tpbmcgaGFzIGJlZW4gc3RhcnRlZCB0aGVuIGJhY2tlbmQgcmVndWxhcmx5IHNlbmRzIGEgY3VycmVudCB2YWx1ZSBmb3IgbGFzdCBzZWVuIG9iamVjdCBpZCBhbmQgY29ycmVzcG9uZGluZyB0aW1lc3RhbXAuIElmIHRoZSB3ZXJlIGNoYW5nZXMgaW4gdGhlIGhlYXAgc2luY2UgbGFzdCBldmVudCB0aGVuIG9uZSBvciBtb3JlIGhlYXBTdGF0c1VwZGF0ZSBldmVudHMgd2lsbCBiZSBzZW50IGJlZm9yZSBhIG5ldyBsYXN0U2Vlbk9iamVjdElkIGV2ZW50LlxuICAgICAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnQgdHlwZSBsYXN0U2Vlbk9iamVjdElkID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBsYXN0U2Vlbk9iamVjdElkOiBudW1iZXJcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG51bWJlclxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIElmIGhlYXAgb2JqZWN0cyB0cmFja2luZyBoYXMgYmVlbiBzdGFydGVkIHRoZW4gYmFja2VuZCBtYXkgc2VuZCB1cGRhdGUgZm9yIG9uZSBvciBtb3JlIGZyYWdtZW50c1xuICAgICAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnQgdHlwZSBoZWFwU3RhdHNVcGRhdGUgPSB7XG4gICAgICAgICAgICAvKiogQW4gYXJyYXkgb2YgdHJpcGxldHMuIEVhY2ggdHJpcGxldCBkZXNjcmliZXMgYSBmcmFnbWVudC4gVGhlIGZpcnN0IGludGVnZXIgaXMgdGhlIGZyYWdtZW50IGluZGV4LCB0aGUgc2Vjb25kIGludGVnZXIgaXMgYSB0b3RhbCBjb3VudCBvZiBvYmplY3RzIGZvciB0aGUgZnJhZ21lbnQsIHRoZSB0aGlyZCBpbnRlZ2VyIGlzIGEgdG90YWwgc2l6ZSBvZiB0aGUgb2JqZWN0cyBmb3IgdGhlIGZyYWdtZW50LiAqL1xuICAgICAgICAgICAgc3RhdHNVcGRhdGU6IG51bWJlcltdXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogTm8gZGVzY3JpcHRpb25cbiAqIEBleHBlcmltZW50YWxcbiAqL1xuY2xhc3MgSGVhcFByb2ZpbGVyIHtcbiAgICBwcml2YXRlIGV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkYmc6IGFueSAvKiBFbGVjdHJvbi5EZWJ1Z2dlciovICkge1xuXG4gICAgICAgIHRoaXMuZGJnLm9uKCdtZXNzYWdlJywgKGV2ZW50OiBhbnksIG1ldGhvZDogYW55LCBwYXJhbXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2RvbWFpbiwgZG9tYWluTWV0aG9kXSA9IG1ldGhvZC5zcGxpdCgnLicpXG4gICAgICAgICAgICB0aGlzLmV2ZW50cy5lbWl0KGRvbWFpbk1ldGhvZCwgcGFyYW1zKVxuICAgICAgICB9KVxuXG4gICAgICAgIGlmICghdGhpcy5kYmcuaXNBdHRhY2hlZCgpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjcmVhdGUgSGVhcFByb2ZpbGVyIERvbWFpbiBDbGFzcyBiZWNhdXNlIHRoZSBkZWJ1Z2dlciBpcyBub3QgYXR0YWNoZWQuYClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBvbihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5ldmVudHMub24oZXZlbnQsIGxpc3RlbmVyKVxuICAgIH1cblxuICAgIHB1YmxpYyBvbmNlKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmV2ZW50cy5vbihldmVudCwgbGlzdGVuZXIpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3NlcnRFcnJvcihlcnJvcjogYW55LCBjb21tYW5kTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICgnbWVzc2FnZScgaW4gZXJyb3IgJiYgJ2NvZGUnIGluIGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRGVidWdnZXJFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5jb2RlLCBjb21tYW5kTmFtZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBlbmFibGUoKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnSGVhcFByb2ZpbGVyLmVuYWJsZScsIHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnSGVhcFByb2ZpbGVyLmVuYWJsZScpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBkaXNhYmxlKCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0hlYXBQcm9maWxlci5kaXNhYmxlJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdIZWFwUHJvZmlsZXIuZGlzYWJsZScpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBzdGFydFRyYWNraW5nSGVhcE9iamVjdHMocGFyYW1zPzogSGVhcFByb2ZpbGVyLlBhcmFtcy5zdGFydFRyYWNraW5nSGVhcE9iamVjdHMpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdIZWFwUHJvZmlsZXIuc3RhcnRUcmFja2luZ0hlYXBPYmplY3RzJywgcGFyYW1zIHx8IHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnSGVhcFByb2ZpbGVyLnN0YXJ0VHJhY2tpbmdIZWFwT2JqZWN0cycpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBzdG9wVHJhY2tpbmdIZWFwT2JqZWN0cyhwYXJhbXM/OiBIZWFwUHJvZmlsZXIuUGFyYW1zLnN0b3BUcmFja2luZ0hlYXBPYmplY3RzKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnSGVhcFByb2ZpbGVyLnN0b3BUcmFja2luZ0hlYXBPYmplY3RzJywgcGFyYW1zIHx8IHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnSGVhcFByb2ZpbGVyLnN0b3BUcmFja2luZ0hlYXBPYmplY3RzJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgcHVibGljIGFzeW5jIHRha2VIZWFwU25hcHNob3QocGFyYW1zPzogSGVhcFByb2ZpbGVyLlBhcmFtcy50YWtlSGVhcFNuYXBzaG90KTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnSGVhcFByb2ZpbGVyLnRha2VIZWFwU25hcHNob3QnLCBwYXJhbXMgfHwge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdIZWFwUHJvZmlsZXIudGFrZUhlYXBTbmFwc2hvdCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBjb2xsZWN0R2FyYmFnZSgpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdIZWFwUHJvZmlsZXIuY29sbGVjdEdhcmJhZ2UnLCB7fSwgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0hlYXBQcm9maWxlci5jb2xsZWN0R2FyYmFnZScpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRPYmplY3RCeUhlYXBPYmplY3RJZChwYXJhbXM6IEhlYXBQcm9maWxlci5QYXJhbXMuZ2V0T2JqZWN0QnlIZWFwT2JqZWN0SWQpOiBQcm9taXNlPEhlYXBQcm9maWxlci5SZXN1bHQuZ2V0T2JqZWN0QnlIZWFwT2JqZWN0SWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8SGVhcFByb2ZpbGVyLlJlc3VsdC5nZXRPYmplY3RCeUhlYXBPYmplY3RJZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0hlYXBQcm9maWxlci5nZXRPYmplY3RCeUhlYXBPYmplY3RJZCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0hlYXBQcm9maWxlci5nZXRPYmplY3RCeUhlYXBPYmplY3RJZCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgSGVhcFByb2ZpbGVyLlJlc3VsdC5nZXRPYmplY3RCeUhlYXBPYmplY3RJZClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIEVuYWJsZXMgY29uc29sZSB0byByZWZlciB0byB0aGUgbm9kZSB3aXRoIGdpdmVuIGlkIHZpYSAkeCAoc2VlIENvbW1hbmQgTGluZSBBUEkgZm9yIG1vcmUgZGV0YWlscyAkeCBmdW5jdGlvbnMpLiAqL1xuICAgIHB1YmxpYyBhc3luYyBhZGRJbnNwZWN0ZWRIZWFwT2JqZWN0KHBhcmFtczogSGVhcFByb2ZpbGVyLlBhcmFtcy5hZGRJbnNwZWN0ZWRIZWFwT2JqZWN0KTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnSGVhcFByb2ZpbGVyLmFkZEluc3BlY3RlZEhlYXBPYmplY3QnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdIZWFwUHJvZmlsZXIuYWRkSW5zcGVjdGVkSGVhcE9iamVjdCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRIZWFwT2JqZWN0SWQocGFyYW1zOiBIZWFwUHJvZmlsZXIuUGFyYW1zLmdldEhlYXBPYmplY3RJZCk6IFByb21pc2U8SGVhcFByb2ZpbGVyLlJlc3VsdC5nZXRIZWFwT2JqZWN0SWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8SGVhcFByb2ZpbGVyLlJlc3VsdC5nZXRIZWFwT2JqZWN0SWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdIZWFwUHJvZmlsZXIuZ2V0SGVhcE9iamVjdElkJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnSGVhcFByb2ZpbGVyLmdldEhlYXBPYmplY3RJZCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgSGVhcFByb2ZpbGVyLlJlc3VsdC5nZXRIZWFwT2JqZWN0SWQpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyBzdGFydFNhbXBsaW5nKHBhcmFtcz86IEhlYXBQcm9maWxlci5QYXJhbXMuc3RhcnRTYW1wbGluZyk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0hlYXBQcm9maWxlci5zdGFydFNhbXBsaW5nJywgcGFyYW1zIHx8IHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnSGVhcFByb2ZpbGVyLnN0YXJ0U2FtcGxpbmcnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBwdWJsaWMgYXN5bmMgc3RvcFNhbXBsaW5nKCk6IFByb21pc2U8SGVhcFByb2ZpbGVyLlJlc3VsdC5zdG9wU2FtcGxpbmc+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8SGVhcFByb2ZpbGVyLlJlc3VsdC5zdG9wU2FtcGxpbmc+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdIZWFwUHJvZmlsZXIuc3RvcFNhbXBsaW5nJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdIZWFwUHJvZmlsZXIuc3RvcFNhbXBsaW5nJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCBhcyBIZWFwUHJvZmlsZXIuUmVzdWx0LnN0b3BTYW1wbGluZylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEhlYXBQcm9maWxlciJdfQ==