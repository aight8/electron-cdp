"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * No description
 * @experimental
 */
class Tracing {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create Tracing Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** Start trace events collection. */
    async start(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tracing.start', params || {}, (error, result) => {
                this.assertError(error, 'Tracing.start');
                resolve();
            });
        });
    }
    /** Stop trace events collection. */
    async end() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tracing.end', {}, (error, result) => {
                this.assertError(error, 'Tracing.end');
                resolve();
            });
        });
    }
    /** Gets supported tracing categories. */
    async getCategories() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tracing.getCategories', {}, (error, result) => {
                this.assertError(error, 'Tracing.getCategories');
                resolve(result);
            });
        });
    }
    /** Request a global memory dump. */
    async requestMemoryDump() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tracing.requestMemoryDump', {}, (error, result) => {
                this.assertError(error, 'Tracing.requestMemoryDump');
                resolve(result);
            });
        });
    }
    /** Record a clock sync marker in the trace. */
    async recordClockSyncMarker(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tracing.recordClockSyncMarker', params, (error, result) => {
                this.assertError(error, 'Tracing.recordClockSyncMarker');
                resolve();
            });
        });
    }
}
exports.default = Tracing;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhY2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL2dlbmVyYXRlZC10cy9UcmFjaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsdUNBQXNDO0FBQ3RDLG1EQUEyQztBQWlNM0M7OztHQUdHO0FBQ0g7SUFHSSxZQUE2QixHQUFRLENBQUMsc0JBQXNCO1FBQS9CLFFBQUcsR0FBSCxHQUFHLENBQUssQ0FBQyxzQkFBc0I7UUFGcEQsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUE7UUFJL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBVSxFQUFFLE1BQVcsRUFBRSxNQUFXO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNoRCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDMUMsQ0FBQyxDQUFDLENBQUE7UUFFRixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sSUFBSSxLQUFLLENBQUMsMEVBQTBFLENBQUMsQ0FBQTtRQUMvRixDQUFDO0lBQ0wsQ0FBQztJQUVNLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBa0I7UUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFTSxJQUFJLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU8sV0FBVyxDQUFDLEtBQVUsRUFBRSxXQUFtQjtRQUMvQyxFQUFFLENBQUMsQ0FBQyxTQUFTLElBQUksS0FBSyxJQUFJLE1BQU0sSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sSUFBSSx1QkFBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQTtRQUNuRSxDQUFDO0lBQ0wsQ0FBQztJQUVELHFDQUFxQztJQUM5QixLQUFLLENBQUMsS0FBSyxDQUFDLE1BQTZCO1FBQzVDLE1BQU0sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFZLENBQUMsT0FBTyxFQUFFLE1BQU07WUFDaEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsZUFBZSxFQUFFLE1BQU0sSUFBSSxFQUFFLEVBQUUsQ0FBQyxLQUFVLEVBQUUsTUFBVztnQkFDeEUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsZUFBZSxDQUFDLENBQUE7Z0JBQ3hDLE9BQU8sRUFBRSxDQUFBO1lBQ2IsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxvQ0FBb0M7SUFDN0IsS0FBSyxDQUFDLEdBQUc7UUFDWixNQUFNLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBWSxDQUFDLE9BQU8sRUFBRSxNQUFNO1lBQ2hELElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGFBQWEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxLQUFVLEVBQUUsTUFBVztnQkFDNUQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsYUFBYSxDQUFDLENBQUE7Z0JBQ3RDLE9BQU8sRUFBRSxDQUFBO1lBQ2IsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCx5Q0FBeUM7SUFDbEMsS0FBSyxDQUFDLGFBQWE7UUFDdEIsTUFBTSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQStCLENBQUMsT0FBTyxFQUFFLE1BQU07WUFDbkUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsdUJBQXVCLEVBQUUsRUFBRSxFQUFFLENBQUMsS0FBVSxFQUFFLE1BQVc7Z0JBQ3RFLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLHVCQUF1QixDQUFDLENBQUE7Z0JBQ2hELE9BQU8sQ0FBQyxNQUFzQyxDQUFDLENBQUE7WUFDbkQsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxvQ0FBb0M7SUFDN0IsS0FBSyxDQUFDLGlCQUFpQjtRQUMxQixNQUFNLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBbUMsQ0FBQyxPQUFPLEVBQUUsTUFBTTtZQUN2RSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsRUFBRSxFQUFFLEVBQUUsQ0FBQyxLQUFVLEVBQUUsTUFBVztnQkFDMUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsMkJBQTJCLENBQUMsQ0FBQTtnQkFDcEQsT0FBTyxDQUFDLE1BQTBDLENBQUMsQ0FBQTtZQUN2RCxDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUVELCtDQUErQztJQUN4QyxLQUFLLENBQUMscUJBQXFCLENBQUMsTUFBNEM7UUFDM0UsTUFBTSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQVksQ0FBQyxPQUFPLEVBQUUsTUFBTTtZQUNoRCxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQywrQkFBK0IsRUFBRSxNQUFNLEVBQUUsQ0FBQyxLQUFVLEVBQUUsTUFBVztnQkFDbEYsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsK0JBQStCLENBQUMsQ0FBQTtnQkFDeEQsT0FBTyxFQUFFLENBQUE7WUFDYixDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUVKO0FBRUQsa0JBQWUsT0FBTyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50cydcbmltcG9ydCBEZWJ1Z2dlckVycm9yIGZyb20gJy4vRGVidWdnZXJFcnJvcidcbmltcG9ydCBJTyBmcm9tICcuL0lPJ1xuXG5kZWNsYXJlIGludGVyZmFjZSBUcmFjaW5nIHtcblxuICAgIC8qKiBDb250YWlucyBhbiBidWNrZXQgb2YgY29sbGVjdGVkIHRyYWNlIGV2ZW50cy4gV2hlbiB0cmFjaW5nIGlzIHN0b3BwZWQgY29sbGVjdGVkIGV2ZW50cyB3aWxsIGJlIHNlbmQgYXMgYSBzZXF1ZW5jZSBvZiBkYXRhQ29sbGVjdGVkIGV2ZW50cyBmb2xsb3dlZCBieSB0cmFjaW5nQ29tcGxldGUgZXZlbnQuICovXG4gICAgb24oZXZlbnQ6ICdkYXRhQ29sbGVjdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IFRyYWNpbmcuRXZlbnRQYXJhbXMuZGF0YUNvbGxlY3RlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogQ29udGFpbnMgYW4gYnVja2V0IG9mIGNvbGxlY3RlZCB0cmFjZSBldmVudHMuIFdoZW4gdHJhY2luZyBpcyBzdG9wcGVkIGNvbGxlY3RlZCBldmVudHMgd2lsbCBiZSBzZW5kIGFzIGEgc2VxdWVuY2Ugb2YgZGF0YUNvbGxlY3RlZCBldmVudHMgZm9sbG93ZWQgYnkgdHJhY2luZ0NvbXBsZXRlIGV2ZW50LiAqL1xuICAgIG9uY2UoZXZlbnQ6ICdkYXRhQ29sbGVjdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IFRyYWNpbmcuRXZlbnRQYXJhbXMuZGF0YUNvbGxlY3RlZCkgPT4gdm9pZCk6IHZvaWRcblxuICAgIC8qKiBTaWduYWxzIHRoYXQgdHJhY2luZyBpcyBzdG9wcGVkIGFuZCB0aGVyZSBpcyBubyB0cmFjZSBidWZmZXJzIHBlbmRpbmcgZmx1c2gsIGFsbCBkYXRhIHdlcmUgZGVsaXZlcmVkIHZpYSBkYXRhQ29sbGVjdGVkIGV2ZW50cy4gKi9cbiAgICBvbihldmVudDogJ3RyYWNpbmdDb21wbGV0ZScsIGxpc3RlbmVyOiAocGFyYW1zOiBUcmFjaW5nLkV2ZW50UGFyYW1zLnRyYWNpbmdDb21wbGV0ZSkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogU2lnbmFscyB0aGF0IHRyYWNpbmcgaXMgc3RvcHBlZCBhbmQgdGhlcmUgaXMgbm8gdHJhY2UgYnVmZmVycyBwZW5kaW5nIGZsdXNoLCBhbGwgZGF0YSB3ZXJlIGRlbGl2ZXJlZCB2aWEgZGF0YUNvbGxlY3RlZCBldmVudHMuICovXG4gICAgb25jZShldmVudDogJ3RyYWNpbmdDb21wbGV0ZScsIGxpc3RlbmVyOiAocGFyYW1zOiBUcmFjaW5nLkV2ZW50UGFyYW1zLnRyYWNpbmdDb21wbGV0ZSkgPT4gdm9pZCk6IHZvaWRcblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIG9uKGV2ZW50OiAnYnVmZmVyVXNhZ2UnLCBsaXN0ZW5lcjogKHBhcmFtczogVHJhY2luZy5FdmVudFBhcmFtcy5idWZmZXJVc2FnZSkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnYnVmZmVyVXNhZ2UnLCBsaXN0ZW5lcjogKHBhcmFtczogVHJhY2luZy5FdmVudFBhcmFtcy5idWZmZXJVc2FnZSkgPT4gdm9pZCk6IHZvaWRcblxufVxuXG5tb2R1bGUgVHJhY2luZyB7XG4gICAgLyoqKioqKioqKioqKioqKlxuICAgICAqKioqIFR5cGVzICoqKipcbiAgICAgKioqKioqKioqKioqKiovXG5cbiAgICAvKipcbiAgICAgKiBDb25maWd1cmF0aW9uIGZvciBtZW1vcnkgZHVtcC4gVXNlZCBvbmx5IHdoZW4gXCJtZW1vcnktaW5mcmFcIiBjYXRlZ29yeSBpcyBlbmFibGVkLlxuICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgKi9cbiAgICBleHBvcnQgdHlwZSBNZW1vcnlEdW1wQ29uZmlnID0gb2JqZWN0XG5cbiAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgIGV4cG9ydCB0eXBlIFRyYWNlQ29uZmlnID0ge1xuICAgICAgICAvKipcbiAgICAgICAgICogQ29udHJvbHMgaG93IHRoZSB0cmFjZSBidWZmZXIgc3RvcmVzIGRhdGEuXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgcmVjb3JkTW9kZT86ICdyZWNvcmRVbnRpbEZ1bGwnIHwgJ3JlY29yZENvbnRpbnVvdXNseScgfCAncmVjb3JkQXNNdWNoQXNQb3NzaWJsZScgfCAnZWNob1RvQ29uc29sZSdcblxuICAgICAgICAvKipcbiAgICAgICAgICogVHVybnMgb24gSmF2YVNjcmlwdCBzdGFjayBzYW1wbGluZy5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBlbmFibGVTYW1wbGluZz86IGJvb2xlYW5cblxuICAgICAgICAvKipcbiAgICAgICAgICogVHVybnMgb24gc3lzdGVtIHRyYWNpbmcuXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgZW5hYmxlU3lzdHJhY2U/OiBib29sZWFuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFR1cm5zIG9uIGFyZ3VtZW50IGZpbHRlci5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBlbmFibGVBcmd1bWVudEZpbHRlcj86IGJvb2xlYW5cblxuICAgICAgICAvKipcbiAgICAgICAgICogSW5jbHVkZWQgY2F0ZWdvcnkgZmlsdGVycy5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBpbmNsdWRlZENhdGVnb3JpZXM/OiBzdHJpbmdbXVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFeGNsdWRlZCBjYXRlZ29yeSBmaWx0ZXJzLlxuICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICovXG4gICAgICAgIGV4Y2x1ZGVkQ2F0ZWdvcmllcz86IHN0cmluZ1tdXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENvbmZpZ3VyYXRpb24gdG8gc3ludGhlc2l6ZSB0aGUgZGVsYXlzIGluIHRyYWNpbmcuXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgc3ludGhldGljRGVsYXlzPzogc3RyaW5nW11cblxuICAgICAgICAvKipcbiAgICAgICAgICogQ29uZmlndXJhdGlvbiBmb3IgbWVtb3J5IGR1bXAgdHJpZ2dlcnMuIFVzZWQgb25seSB3aGVuIFwibWVtb3J5LWluZnJhXCIgY2F0ZWdvcnkgaXMgZW5hYmxlZC5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBtZW1vcnlEdW1wQ29uZmlnPzogTWVtb3J5RHVtcENvbmZpZ1xuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgc3RhcnQgPSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENhdGVnb3J5L3RhZyBmaWx0ZXJcbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjYXRlZ29yaWVzPzogc3RyaW5nXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVHJhY2luZyBvcHRpb25zXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb3B0aW9ucz86IHN0cmluZ1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIElmIHNldCwgdGhlIGFnZW50IHdpbGwgaXNzdWUgYnVmZmVyVXNhZ2UgZXZlbnRzIGF0IHRoaXMgaW50ZXJ2YWwsIHNwZWNpZmllZCBpbiBtaWxsaXNlY29uZHNcbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBidWZmZXJVc2FnZVJlcG9ydGluZ0ludGVydmFsPzogbnVtYmVyXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2hldGhlciB0byByZXBvcnQgdHJhY2UgZXZlbnRzIGFzIHNlcmllcyBvZiBkYXRhQ29sbGVjdGVkIGV2ZW50cyBvciB0byBzYXZlIHRyYWNlIHRvIGEgc3RyZWFtIChkZWZhdWx0cyB0byA8Y29kZT5SZXBvcnRFdmVudHM8L2NvZGU+KS5cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0cmFuc2Zlck1vZGU/OiAnUmVwb3J0RXZlbnRzJyB8ICdSZXR1cm5Bc1N0cmVhbSdcblxuICAgICAgICAgICAgLyoqIEBvcHRpb25hbCAqL1xuICAgICAgICAgICAgdHJhY2VDb25maWc/OiBUcmFjZUNvbmZpZ1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgcmVjb3JkQ2xvY2tTeW5jTWFya2VyID0ge1xuICAgICAgICAgICAgLyoqIFRoZSBJRCBvZiB0aGlzIGNsb2NrIHN5bmMgbWFya2VyICovXG4gICAgICAgICAgICBzeW5jSWQ6IHN0cmluZ1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqKioqIENvbW1hbmQgUmVzdWx0ICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKiovXG4gICAgZXhwb3J0IG1vZHVsZSBSZXN1bHQge1xuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBnZXRDYXRlZ29yaWVzID0ge1xuICAgICAgICAgICAgLyoqIEEgbGlzdCBvZiBzdXBwb3J0ZWQgdHJhY2luZyBjYXRlZ29yaWVzLiAqL1xuICAgICAgICAgICAgY2F0ZWdvcmllczogc3RyaW5nW11cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHJlcXVlc3RNZW1vcnlEdW1wID0ge1xuICAgICAgICAgICAgLyoqIEdVSUQgb2YgdGhlIHJlc3VsdGluZyBnbG9iYWwgbWVtb3J5IGR1bXAuICovXG4gICAgICAgICAgICBkdW1wR3VpZDogc3RyaW5nXG5cbiAgICAgICAgICAgIC8qKiBUcnVlIGlmZiB0aGUgZ2xvYmFsIG1lbW9yeSBkdW1wIHN1Y2NlZWRlZC4gKi9cbiAgICAgICAgICAgIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqKioqIEV2ZW50IFBhcmFtZXRlcnMgKioqKlxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgRXZlbnRQYXJhbXMge1xuICAgICAgICAvKipcbiAgICAgICAgICogQ29udGFpbnMgYW4gYnVja2V0IG9mIGNvbGxlY3RlZCB0cmFjZSBldmVudHMuIFdoZW4gdHJhY2luZyBpcyBzdG9wcGVkIGNvbGxlY3RlZCBldmVudHMgd2lsbCBiZSBzZW5kIGFzIGEgc2VxdWVuY2Ugb2YgZGF0YUNvbGxlY3RlZCBldmVudHMgZm9sbG93ZWQgYnkgdHJhY2luZ0NvbXBsZXRlIGV2ZW50LlxuICAgICAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICAgICAqL1xuICAgICAgICBleHBvcnQgdHlwZSBkYXRhQ29sbGVjdGVkID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICB2YWx1ZTogb2JqZWN0W11cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaWduYWxzIHRoYXQgdHJhY2luZyBpcyBzdG9wcGVkIGFuZCB0aGVyZSBpcyBubyB0cmFjZSBidWZmZXJzIHBlbmRpbmcgZmx1c2gsIGFsbCBkYXRhIHdlcmUgZGVsaXZlcmVkIHZpYSBkYXRhQ29sbGVjdGVkIGV2ZW50cy5cbiAgICAgICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAgICAgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgdHJhY2luZ0NvbXBsZXRlID0ge1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBBIGhhbmRsZSBvZiB0aGUgc3RyZWFtIHRoYXQgaG9sZHMgcmVzdWx0aW5nIHRyYWNlIGRhdGEuXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgc3RyZWFtPzogSU8uU3RyZWFtSGFuZGxlXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBidWZmZXJVc2FnZSA9IHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogQSBudW1iZXIgaW4gcmFuZ2UgWzAuLjFdIHRoYXQgaW5kaWNhdGVzIHRoZSB1c2VkIHNpemUgb2YgZXZlbnQgYnVmZmVyIGFzIGEgZnJhY3Rpb24gb2YgaXRzIHRvdGFsIHNpemUuXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcGVyY2VudEZ1bGw/OiBudW1iZXJcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBBbiBhcHByb3hpbWF0ZSBudW1iZXIgb2YgZXZlbnRzIGluIHRoZSB0cmFjZSBsb2cuXG4gICAgICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZXZlbnRDb3VudD86IG51bWJlclxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEEgbnVtYmVyIGluIHJhbmdlIFswLi4xXSB0aGF0IGluZGljYXRlcyB0aGUgdXNlZCBzaXplIG9mIGV2ZW50IGJ1ZmZlciBhcyBhIGZyYWN0aW9uIG9mIGl0cyB0b3RhbCBzaXplLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHZhbHVlPzogbnVtYmVyXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogTm8gZGVzY3JpcHRpb25cbiAqIEBleHBlcmltZW50YWxcbiAqL1xuY2xhc3MgVHJhY2luZyB7XG4gICAgcHJpdmF0ZSBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKClcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZGJnOiBhbnkgLyogRWxlY3Ryb24uRGVidWdnZXIqLyApIHtcblxuICAgICAgICB0aGlzLmRiZy5vbignbWVzc2FnZScsIChldmVudDogYW55LCBtZXRob2Q6IGFueSwgcGFyYW1zOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtkb21haW4sIGRvbWFpbk1ldGhvZF0gPSBtZXRob2Quc3BsaXQoJy4nKVxuICAgICAgICAgICAgdGhpcy5ldmVudHMuZW1pdChkb21haW5NZXRob2QsIHBhcmFtcylcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXRoaXMuZGJnLmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIFRyYWNpbmcgRG9tYWluIENsYXNzIGJlY2F1c2UgdGhlIGRlYnVnZ2VyIGlzIG5vdCBhdHRhY2hlZC5gKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmV2ZW50cy5vbihldmVudCwgbGlzdGVuZXIpXG4gICAgfVxuXG4gICAgcHVibGljIG9uY2UoZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKGV2ZW50LCBsaXN0ZW5lcilcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzc2VydEVycm9yKGVycm9yOiBhbnksIGNvbW1hbmROYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCdtZXNzYWdlJyBpbiBlcnJvciAmJiAnY29kZScgaW4gZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBEZWJ1Z2dlckVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLmNvZGUsIGNvbW1hbmROYW1lKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIFN0YXJ0IHRyYWNlIGV2ZW50cyBjb2xsZWN0aW9uLiAqL1xuICAgIHB1YmxpYyBhc3luYyBzdGFydChwYXJhbXM/OiBUcmFjaW5nLlBhcmFtcy5zdGFydCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RyYWNpbmcuc3RhcnQnLCBwYXJhbXMgfHwge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUcmFjaW5nLnN0YXJ0JylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIFN0b3AgdHJhY2UgZXZlbnRzIGNvbGxlY3Rpb24uICovXG4gICAgcHVibGljIGFzeW5jIGVuZCgpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdUcmFjaW5nLmVuZCcsIHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVHJhY2luZy5lbmQnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogR2V0cyBzdXBwb3J0ZWQgdHJhY2luZyBjYXRlZ29yaWVzLiAqL1xuICAgIHB1YmxpYyBhc3luYyBnZXRDYXRlZ29yaWVzKCk6IFByb21pc2U8VHJhY2luZy5SZXN1bHQuZ2V0Q2F0ZWdvcmllcz57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxUcmFjaW5nLlJlc3VsdC5nZXRDYXRlZ29yaWVzPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVHJhY2luZy5nZXRDYXRlZ29yaWVzJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUcmFjaW5nLmdldENhdGVnb3JpZXMnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0IGFzIFRyYWNpbmcuUmVzdWx0LmdldENhdGVnb3JpZXMpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZXF1ZXN0IGEgZ2xvYmFsIG1lbW9yeSBkdW1wLiAqL1xuICAgIHB1YmxpYyBhc3luYyByZXF1ZXN0TWVtb3J5RHVtcCgpOiBQcm9taXNlPFRyYWNpbmcuUmVzdWx0LnJlcXVlc3RNZW1vcnlEdW1wPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPFRyYWNpbmcuUmVzdWx0LnJlcXVlc3RNZW1vcnlEdW1wPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnVHJhY2luZy5yZXF1ZXN0TWVtb3J5RHVtcCcsIHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVHJhY2luZy5yZXF1ZXN0TWVtb3J5RHVtcCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgVHJhY2luZy5SZXN1bHQucmVxdWVzdE1lbW9yeUR1bXApXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZWNvcmQgYSBjbG9jayBzeW5jIG1hcmtlciBpbiB0aGUgdHJhY2UuICovXG4gICAgcHVibGljIGFzeW5jIHJlY29yZENsb2NrU3luY01hcmtlcihwYXJhbXM6IFRyYWNpbmcuUGFyYW1zLnJlY29yZENsb2NrU3luY01hcmtlcik6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RyYWNpbmcucmVjb3JkQ2xvY2tTeW5jTWFya2VyJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVHJhY2luZy5yZWNvcmRDbG9ja1N5bmNNYXJrZXInKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgVHJhY2luZyJdfQ==