"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * Query and modify DOM storage.
 * @experimental
 */
class DOMStorage {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create DOMStorage Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** Enables storage tracking, storage events will now be delivered to the client. */
    async enable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.enable', {}, (error, result) => {
                this.assertError(error, 'DOMStorage.enable');
                resolve();
            });
        });
    }
    /** Disables storage tracking, prevents storage events from being sent to the client. */
    async disable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.disable', {}, (error, result) => {
                this.assertError(error, 'DOMStorage.disable');
                resolve();
            });
        });
    }
    /** No description */
    async clear(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.clear', params, (error, result) => {
                this.assertError(error, 'DOMStorage.clear');
                resolve();
            });
        });
    }
    /** No description */
    async getDOMStorageItems(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.getDOMStorageItems', params, (error, result) => {
                this.assertError(error, 'DOMStorage.getDOMStorageItems');
                resolve(result);
            });
        });
    }
    /** No description */
    async setDOMStorageItem(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.setDOMStorageItem', params, (error, result) => {
                this.assertError(error, 'DOMStorage.setDOMStorageItem');
                resolve();
            });
        });
    }
    /** No description */
    async removeDOMStorageItem(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('DOMStorage.removeDOMStorageItem', params, (error, result) => {
                this.assertError(error, 'DOMStorage.removeDOMStorageItem');
                resolve();
            });
        });
    }
}
exports.default = DOMStorage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NU3RvcmFnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL2dlbmVyYXRlZC10cy9ET01TdG9yYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsdUNBQXNDO0FBQ3RDLG1EQUEyQztBQWtKM0M7OztHQUdHO0FBQ0g7SUFHSSxZQUE2QixHQUFRLENBQUMsc0JBQXNCO1FBQS9CLFFBQUcsR0FBSCxHQUFHLENBQUssQ0FBQyxzQkFBc0I7UUFGcEQsV0FBTSxHQUFHLElBQUksWUFBWSxFQUFFLENBQUE7UUFJL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBVSxFQUFFLE1BQVcsRUFBRSxNQUFXO1lBQ3hELE1BQU0sQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUNoRCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUE7UUFDMUMsQ0FBQyxDQUFDLENBQUE7UUFFRixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sSUFBSSxLQUFLLENBQUMsNkVBQTZFLENBQUMsQ0FBQTtRQUNsRyxDQUFDO0lBQ0wsQ0FBQztJQUVNLEVBQUUsQ0FBQyxLQUFhLEVBQUUsUUFBa0I7UUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFTSxJQUFJLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU8sV0FBVyxDQUFDLEtBQVUsRUFBRSxXQUFtQjtRQUMvQyxFQUFFLENBQUMsQ0FBQyxTQUFTLElB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LEVBQUUsTUFBTSxFQUFFLENBQUMsS0FBVSxFQUFFLE1BQVc7Z0JBQ3BGLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLGlDQUFpQyxDQUFDLENBQUE7Z0JBQzFELE9BQU8sRUFBRSxDQUFBO1lBQ2IsQ0FBQyxDQUFDLENBQUE7UUFDTixDQUFDLENBQUMsQ0FBQTtJQUNOLENBQUM7Q0FFSjtBQUVELGtCQUFlLFVBQVUsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnXG5pbXBvcnQgRGVidWdnZXJFcnJvciBmcm9tICcuL0RlYnVnZ2VyRXJyb3InXG5cbmRlY2xhcmUgaW50ZXJmYWNlIERPTVN0b3JhZ2Uge1xuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb24oZXZlbnQ6ICdkb21TdG9yYWdlSXRlbXNDbGVhcmVkJywgbGlzdGVuZXI6IChwYXJhbXM6IERPTVN0b3JhZ2UuRXZlbnRQYXJhbXMuZG9tU3RvcmFnZUl0ZW1zQ2xlYXJlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnZG9tU3RvcmFnZUl0ZW1zQ2xlYXJlZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBET01TdG9yYWdlLkV2ZW50UGFyYW1zLmRvbVN0b3JhZ2VJdGVtc0NsZWFyZWQpID0+IHZvaWQpOiB2b2lkXG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbihldmVudDogJ2RvbVN0b3JhZ2VJdGVtUmVtb3ZlZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBET01TdG9yYWdlLkV2ZW50UGFyYW1zLmRvbVN0b3JhZ2VJdGVtUmVtb3ZlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnZG9tU3RvcmFnZUl0ZW1SZW1vdmVkJywgbGlzdGVuZXI6IChwYXJhbXM6IERPTVN0b3JhZ2UuRXZlbnRQYXJhbXMuZG9tU3RvcmFnZUl0ZW1SZW1vdmVkKSA9PiB2b2lkKTogdm9pZFxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb24oZXZlbnQ6ICdkb21TdG9yYWdlSXRlbUFkZGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IERPTVN0b3JhZ2UuRXZlbnRQYXJhbXMuZG9tU3RvcmFnZUl0ZW1BZGRlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnZG9tU3RvcmFnZUl0ZW1BZGRlZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBET01TdG9yYWdlLkV2ZW50UGFyYW1zLmRvbVN0b3JhZ2VJdGVtQWRkZWQpID0+IHZvaWQpOiB2b2lkXG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbihldmVudDogJ2RvbVN0b3JhZ2VJdGVtVXBkYXRlZCcsIGxpc3RlbmVyOiAocGFyYW1zOiBET01TdG9yYWdlLkV2ZW50UGFyYW1zLmRvbVN0b3JhZ2VJdGVtVXBkYXRlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnZG9tU3RvcmFnZUl0ZW1VcGRhdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IERPTVN0b3JhZ2UuRXZlbnRQYXJhbXMuZG9tU3RvcmFnZUl0ZW1VcGRhdGVkKSA9PiB2b2lkKTogdm9pZFxuXG59XG5cbm1vZHVsZSBET01TdG9yYWdlIHtcbiAgICAvKioqKioqKioqKioqKioqXG4gICAgICoqKiogVHlwZXMgKioqKlxuICAgICAqKioqKioqKioqKioqKi9cblxuICAgIC8qKlxuICAgICAqIERPTSBTdG9yYWdlIGlkZW50aWZpZXIuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIFN0b3JhZ2VJZCA9IHtcbiAgICAgICAgLyoqIFNlY3VyaXR5IG9yaWdpbiBmb3IgdGhlIHN0b3JhZ2UuICovXG4gICAgICAgIHNlY3VyaXR5T3JpZ2luOiBzdHJpbmdcblxuICAgICAgICAvKiogV2hldGhlciB0aGUgc3RvcmFnZSBpcyBsb2NhbCBzdG9yYWdlIChub3Qgc2Vzc2lvbiBzdG9yYWdlKS4gKi9cbiAgICAgICAgaXNMb2NhbFN0b3JhZ2U6IGJvb2xlYW5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBET00gU3RvcmFnZSBpdGVtLlxuICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgKi9cbiAgICBleHBvcnQgdHlwZSBJdGVtID0gc3RyaW5nW11cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgY2xlYXIgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHN0b3JhZ2VJZDogU3RvcmFnZUlkXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBnZXRET01TdG9yYWdlSXRlbXMgPSB7XG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHN0b3JhZ2VJZDogU3RvcmFnZUlkXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzZXRET01TdG9yYWdlSXRlbSA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgc3RvcmFnZUlkOiBTdG9yYWdlSWRcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBrZXk6IHN0cmluZ1xuXG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIHZhbHVlOiBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHJlbW92ZURPTVN0b3JhZ2VJdGVtID0ge1xuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBzdG9yYWdlSWQ6IFN0b3JhZ2VJZFxuXG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIGtleTogc3RyaW5nXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBSZXN1bHQgKioqKlxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICBleHBvcnQgbW9kdWxlIFJlc3VsdCB7XG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGdldERPTVN0b3JhZ2VJdGVtcyA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgZW50cmllczogSXRlbVtdXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgKioqKiBFdmVudCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKi9cbiAgICBleHBvcnQgbW9kdWxlIEV2ZW50UGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZG9tU3RvcmFnZUl0ZW1zQ2xlYXJlZCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgc3RvcmFnZUlkOiBTdG9yYWdlSWRcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGRvbVN0b3JhZ2VJdGVtUmVtb3ZlZCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgc3RvcmFnZUlkOiBTdG9yYWdlSWRcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBrZXk6IHN0cmluZ1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgZG9tU3RvcmFnZUl0ZW1BZGRlZCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgc3RvcmFnZUlkOiBTdG9yYWdlSWRcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBrZXk6IHN0cmluZ1xuXG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIG5ld1ZhbHVlOiBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGRvbVN0b3JhZ2VJdGVtVXBkYXRlZCA9IHtcbiAgICAgICAgICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgICAgICAgICAgc3RvcmFnZUlkOiBTdG9yYWdlSWRcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBrZXk6IHN0cmluZ1xuXG4gICAgICAgICAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICAgICAgICAgIG9sZFZhbHVlOiBzdHJpbmdcblxuICAgICAgICAgICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgICAgICAgICBuZXdWYWx1ZTogc3RyaW5nXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogUXVlcnkgYW5kIG1vZGlmeSBET00gc3RvcmFnZS5cbiAqIEBleHBlcmltZW50YWxcbiAqL1xuY2xhc3MgRE9NU3RvcmFnZSB7XG4gICAgcHJpdmF0ZSBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKClcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZGJnOiBhbnkgLyogRWxlY3Ryb24uRGVidWdnZXIqLyApIHtcblxuICAgICAgICB0aGlzLmRiZy5vbignbWVzc2FnZScsIChldmVudDogYW55LCBtZXRob2Q6IGFueSwgcGFyYW1zOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtkb21haW4sIGRvbWFpbk1ldGhvZF0gPSBtZXRob2Quc3BsaXQoJy4nKVxuICAgICAgICAgICAgdGhpcy5ldmVudHMuZW1pdChkb21haW5NZXRob2QsIHBhcmFtcylcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXRoaXMuZGJnLmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIERPTVN0b3JhZ2UgRG9tYWluIENsYXNzIGJlY2F1c2UgdGhlIGRlYnVnZ2VyIGlzIG5vdCBhdHRhY2hlZC5gKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9uKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmV2ZW50cy5vbihldmVudCwgbGlzdGVuZXIpXG4gICAgfVxuXG4gICAgcHVibGljIG9uY2UoZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKGV2ZW50LCBsaXN0ZW5lcilcbiAgICB9XG5cbiAgICBwcml2YXRlIGFzc2VydEVycm9yKGVycm9yOiBhbnksIGNvbW1hbmROYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgaWYgKCdtZXNzYWdlJyBpbiBlcnJvciAmJiAnY29kZScgaW4gZXJyb3IpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBEZWJ1Z2dlckVycm9yKGVycm9yLm1lc3NhZ2UsIGVycm9yLmNvZGUsIGNvbW1hbmROYW1lKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEVuYWJsZXMgc3RvcmFnZSB0cmFja2luZywgc3RvcmFnZSBldmVudHMgd2lsbCBub3cgYmUgZGVsaXZlcmVkIHRvIHRoZSBjbGllbnQuICovXG4gICAgcHVibGljIGFzeW5jIGVuYWJsZSgpOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdET01TdG9yYWdlLmVuYWJsZScsIHt9LCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnRE9NU3RvcmFnZS5lbmFibGUnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogRGlzYWJsZXMgc3RvcmFnZSB0cmFja2luZywgcHJldmVudHMgc3RvcmFnZSBldmVudHMgZnJvbSBiZWluZyBzZW50IHRvIHRoZSBjbGllbnQuICovXG4gICAgcHVibGljIGFzeW5jIGRpc2FibGUoKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnRE9NU3RvcmFnZS5kaXNhYmxlJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdET01TdG9yYWdlLmRpc2FibGUnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBwdWJsaWMgYXN5bmMgY2xlYXIocGFyYW1zOiBET01TdG9yYWdlLlBhcmFtcy5jbGVhcik6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0RPTVN0b3JhZ2UuY2xlYXInLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdET01TdG9yYWdlLmNsZWFyJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgcHVibGljIGFzeW5jIGdldERPTVN0b3JhZ2VJdGVtcyhwYXJhbXM6IERPTVN0b3JhZ2UuUGFyYW1zLmdldERPTVN0b3JhZ2VJdGVtcyk6IFByb21pc2U8RE9NU3RvcmFnZS5SZXN1bHQuZ2V0RE9NU3RvcmFnZUl0ZW1zPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPERPTVN0b3JhZ2UuUmVzdWx0LmdldERPTVN0b3JhZ2VJdGVtcz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0RPTVN0b3JhZ2UuZ2V0RE9NU3RvcmFnZUl0ZW1zJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnRE9NU3RvcmFnZS5nZXRET01TdG9yYWdlSXRlbXMnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0IGFzIERPTVN0b3JhZ2UuUmVzdWx0LmdldERPTVN0b3JhZ2VJdGVtcylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgcHVibGljIGFzeW5jIHNldERPTVN0b3JhZ2VJdGVtKHBhcmFtczogRE9NU3RvcmFnZS5QYXJhbXMuc2V0RE9NU3RvcmFnZUl0ZW0pOiBQcm9taXNlPHVuZGVmaW5lZD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx1bmRlZmluZWQ+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdET01TdG9yYWdlLnNldERPTVN0b3JhZ2VJdGVtJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnRE9NU3RvcmFnZS5zZXRET01TdG9yYWdlSXRlbScpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIHB1YmxpYyBhc3luYyByZW1vdmVET01TdG9yYWdlSXRlbShwYXJhbXM6IERPTVN0b3JhZ2UuUGFyYW1zLnJlbW92ZURPTVN0b3JhZ2VJdGVtKTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnRE9NU3RvcmFnZS5yZW1vdmVET01TdG9yYWdlSXRlbScsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0RPTVN0b3JhZ2UucmVtb3ZlRE9NU3RvcmFnZUl0ZW0nKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRE9NU3RvcmFnZSJdfQ==