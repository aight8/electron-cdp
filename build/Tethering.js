"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * The Tethering domain defines methods and events for browser port binding.
 * @experimental
 */
class Tethering {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create Tethering Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** Request browser port binding. */
    async bind(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tethering.bind', params, (error, result) => {
                this.assertError(error, 'Tethering.bind');
                resolve();
            });
        });
    }
    /** Request browser port unbinding. */
    async unbind(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('Tethering.unbind', params, (error, result) => {
                this.assertError(error, 'Tethering.unbind');
                resolve();
            });
        });
    }
}
exports.default = Tethering;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGV0aGVyaW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vZ2VuZXJhdGVkLXRzL1RldGhlcmluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFzQztBQUN0QyxtREFBMkM7QUF1RDNDOzs7R0FHRztBQUNIO0lBR0ksWUFBNkIsR0FBUSxDQUFDLHNCQUFzQjtRQUEvQixRQUFHLEdBQUgsR0FBRyxDQUFLLENBQUMsc0JBQXNCO1FBRnBELFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO1FBSS9CLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVztZQUN4RCxNQUFNLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzFDLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLDRFQUE0RSxDQUFDLENBQUE7UUFDakcsQ0FBQztJQUNMLENBQUM7SUFFTSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU0sSUFBSSxDQUFDLEtBQWEsRUFBRSxRQUFrQjtRQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVPLFdBQVcsQ0FBQyxLQUFVLEVBQUUsV0FBbUI7UUFDL0MsRUFBRSxDQUFDLENBQUMsU0FBUyxJQUFJLEtBQUssSUFBSSxNQUFNLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN4QyxNQUFNLElBQUksdUJBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDbkUsQ0FBQztJQUNMLENBQUM7SUFFRCxvQ0FBb0M7SUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUE2QjtRQUMzQyxNQUFNLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBWSxDQUFDLE9BQU8sRUFBRSxNQUFNO1lBQ2hELElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXO2dCQUNuRSxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFBO2dCQUN6QyxPQUFPLEVBQUUsQ0FBQTtZQUNiLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0lBRUQsc0NBQXNDO0lBQy9CLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBK0I7UUFDL0MsTUFBTSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQVksQ0FBQyxPQUFPLEVBQUUsTUFBTTtZQUNoRCxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsRUFBRSxNQUFNLEVBQUUsQ0FBQyxLQUFVLEVBQUUsTUFBVztnQkFDckUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsa0JBQWtCLENBQUMsQ0FBQTtnQkFDM0MsT0FBTyxFQUFFLENBQUE7WUFDYixDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztDQUVKO0FBRUQsa0JBQWUsU0FBUyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50cydcbmltcG9ydCBEZWJ1Z2dlckVycm9yIGZyb20gJy4vRGVidWdnZXJFcnJvcidcblxuZGVjbGFyZSBpbnRlcmZhY2UgVGV0aGVyaW5nIHtcblxuICAgIC8qKiBJbmZvcm1zIHRoYXQgcG9ydCB3YXMgc3VjY2Vzc2Z1bGx5IGJvdW5kIGFuZCBnb3QgYSBzcGVjaWZpZWQgY29ubmVjdGlvbiBpZC4gKi9cbiAgICBvbihldmVudDogJ2FjY2VwdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IFRldGhlcmluZy5FdmVudFBhcmFtcy5hY2NlcHRlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogSW5mb3JtcyB0aGF0IHBvcnQgd2FzIHN1Y2Nlc3NmdWxseSBib3VuZCBhbmQgZ290IGEgc3BlY2lmaWVkIGNvbm5lY3Rpb24gaWQuICovXG4gICAgb25jZShldmVudDogJ2FjY2VwdGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IFRldGhlcmluZy5FdmVudFBhcmFtcy5hY2NlcHRlZCkgPT4gdm9pZCk6IHZvaWRcblxufVxuXG5tb2R1bGUgVGV0aGVyaW5nIHtcbiAgICAvKioqKioqKioqKioqKioqXG4gICAgICoqKiogVHlwZXMgKioqKlxuICAgICAqKioqKioqKioqKioqKi9cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgYmluZCA9IHtcbiAgICAgICAgICAgIC8qKiBQb3J0IG51bWJlciB0byBiaW5kLiAqL1xuICAgICAgICAgICAgcG9ydDogbnVtYmVyXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSB1bmJpbmQgPSB7XG4gICAgICAgICAgICAvKiogUG9ydCBudW1iZXIgdG8gdW5iaW5kLiAqL1xuICAgICAgICAgICAgcG9ydDogbnVtYmVyXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBSZXN1bHQgKioqKlxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqKioqIEV2ZW50IFBhcmFtZXRlcnMgKioqKlxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgRXZlbnRQYXJhbXMge1xuICAgICAgICAvKipcbiAgICAgICAgICogSW5mb3JtcyB0aGF0IHBvcnQgd2FzIHN1Y2Nlc3NmdWxseSBib3VuZCBhbmQgZ290IGEgc3BlY2lmaWVkIGNvbm5lY3Rpb24gaWQuXG4gICAgICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgICAgICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGFjY2VwdGVkID0ge1xuICAgICAgICAgICAgLyoqIFBvcnQgbnVtYmVyIHRoYXQgd2FzIHN1Y2Nlc3NmdWxseSBib3VuZC4gKi9cbiAgICAgICAgICAgIHBvcnQ6IG51bWJlclxuXG4gICAgICAgICAgICAvKiogQ29ubmVjdGlvbiBpZCB0byBiZSB1c2VkLiAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbklkOiBzdHJpbmdcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgVGV0aGVyaW5nIGRvbWFpbiBkZWZpbmVzIG1ldGhvZHMgYW5kIGV2ZW50cyBmb3IgYnJvd3NlciBwb3J0IGJpbmRpbmcuXG4gKiBAZXhwZXJpbWVudGFsXG4gKi9cbmNsYXNzIFRldGhlcmluZyB7XG4gICAgcHJpdmF0ZSBldmVudHMgPSBuZXcgRXZlbnRFbWl0dGVyKClcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgZGJnOiBhbnkgLyogRWxlY3Ryb24uRGVidWdnZXIqLyApIHtcblxuICAgICAgICB0aGlzLmRiZy5vbignbWVzc2FnZScsIChldmVudDogYW55LCBtZXRob2Q6IGFueSwgcGFyYW1zOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFtkb21haW4sIGRvbWFpbk1ldGhvZF0gPSBtZXRob2Quc3BsaXQoJy4nKVxuICAgICAgICAgICAgdGhpcy5ldmVudHMuZW1pdChkb21haW5NZXRob2QsIHBhcmFtcylcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXRoaXMuZGJnLmlzQXR0YWNoZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIFRldGhlcmluZyBEb21haW4gQ2xhc3MgYmVjYXVzZSB0aGUgZGVidWdnZXIgaXMgbm90IGF0dGFjaGVkLmApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgb24oZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEZ1bmN0aW9uKSB7XG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKGV2ZW50LCBsaXN0ZW5lcilcbiAgICB9XG5cbiAgICBwdWJsaWMgb25jZShldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5ldmVudHMub24oZXZlbnQsIGxpc3RlbmVyKVxuICAgIH1cblxuICAgIHByaXZhdGUgYXNzZXJ0RXJyb3IoZXJyb3I6IGFueSwgY29tbWFuZE5hbWU6IHN0cmluZykge1xuICAgICAgICBpZiAoJ21lc3NhZ2UnIGluIGVycm9yICYmICdjb2RlJyBpbiBlcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IERlYnVnZ2VyRXJyb3IoZXJyb3IubWVzc2FnZSwgZXJyb3IuY29kZSwgY29tbWFuZE5hbWUpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogUmVxdWVzdCBicm93c2VyIHBvcnQgYmluZGluZy4gKi9cbiAgICBwdWJsaWMgYXN5bmMgYmluZChwYXJhbXM6IFRldGhlcmluZy5QYXJhbXMuYmluZCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RldGhlcmluZy5iaW5kJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnVGV0aGVyaW5nLmJpbmQnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogUmVxdWVzdCBicm93c2VyIHBvcnQgdW5iaW5kaW5nLiAqL1xuICAgIHB1YmxpYyBhc3luYyB1bmJpbmQocGFyYW1zOiBUZXRoZXJpbmcuUGFyYW1zLnVuYmluZCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ1RldGhlcmluZy51bmJpbmQnLCBwYXJhbXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdUZXRoZXJpbmcudW5iaW5kJylcbiAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IFRldGhlcmluZyJdfQ==