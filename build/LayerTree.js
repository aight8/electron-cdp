"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventEmitter = require("events");
const DebuggerError_1 = require("./DebuggerError");
/**
 * No description
 * @experimental
 */
class LayerTree {
    constructor(dbg /* Electron.Debugger*/) {
        this.dbg = dbg; /* Electron.Debugger*/
        this.events = new EventEmitter();
        this.dbg.on('message', (event, method, params) => {
            const [domain, domainMethod] = method.split('.');
            this.events.emit(domainMethod, params);
        });
        if (!this.dbg.isAttached()) {
            throw new Error(`Cannot create LayerTree Domain Class because the debugger is not attached.`);
        }
    }
    on(event, listener) {
        this.events.on(event, listener);
    }
    once(event, listener) {
        this.events.on(event, listener);
    }
    assertError(error, commandName) {
        if ('message' in error && 'code' in error) {
            throw new DebuggerError_1.default(error.message, error.code, commandName);
        }
    }
    /** Enables compositing tree inspection. */
    async enable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.enable', {}, (error, result) => {
                this.assertError(error, 'LayerTree.enable');
                resolve();
            });
        });
    }
    /** Disables compositing tree inspection. */
    async disable() {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.disable', {}, (error, result) => {
                this.assertError(error, 'LayerTree.disable');
                resolve();
            });
        });
    }
    /** Provides the reasons why the given layer was composited. */
    async compositingReasons(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.compositingReasons', params, (error, result) => {
                this.assertError(error, 'LayerTree.compositingReasons');
                resolve(result);
            });
        });
    }
    /** Returns the layer snapshot identifier. */
    async makeSnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.makeSnapshot', params, (error, result) => {
                this.assertError(error, 'LayerTree.makeSnapshot');
                resolve(result);
            });
        });
    }
    /** Returns the snapshot identifier. */
    async loadSnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.loadSnapshot', params, (error, result) => {
                this.assertError(error, 'LayerTree.loadSnapshot');
                resolve(result);
            });
        });
    }
    /** Releases layer snapshot captured by the back-end. */
    async releaseSnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.releaseSnapshot', params, (error, result) => {
                this.assertError(error, 'LayerTree.releaseSnapshot');
                resolve();
            });
        });
    }
    /** No description */
    async profileSnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.profileSnapshot', params, (error, result) => {
                this.assertError(error, 'LayerTree.profileSnapshot');
                resolve(result);
            });
        });
    }
    /** Replays the layer snapshot and returns the resulting bitmap. */
    async replaySnapshot(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.replaySnapshot', params, (error, result) => {
                this.assertError(error, 'LayerTree.replaySnapshot');
                resolve(result);
            });
        });
    }
    /** Replays the layer snapshot and returns canvas log. */
    async snapshotCommandLog(params) {
        return await new Promise((resolve, reject) => {
            this.dbg.sendCommand('LayerTree.snapshotCommandLog', params, (error, result) => {
                this.assertError(error, 'LayerTree.snapshotCommandLog');
                resolve(result);
            });
        });
    }
}
exports.default = LayerTree;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGF5ZXJUcmVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vZ2VuZXJhdGVkLXRzL0xheWVyVHJlZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFzQztBQUN0QyxtREFBMkM7QUFrUzNDOzs7R0FHRztBQUNIO0lBR0ksWUFBNkIsR0FBUSxDQUFDLHNCQUFzQjtRQUEvQixRQUFHLEdBQUgsR0FBRyxDQUFLLENBQUMsc0JBQXNCO1FBRnBELFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFBO1FBSS9CLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXLEVBQUUsTUFBVztZQUN4RCxNQUFNLENBQUMsTUFBTSxFQUFFLFlBQVksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDaEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzFDLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLElBQUksS0FBSyxDQUFDLDRFQUE0RSxDQUFDLENBQUE7UUFDakcsQ0FBQztJQUNMLENBQUM7SUFFTSxFQUFFLENBQUMsS0FBYSxFQUFFLFFBQWtCO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU0sSUFBSSxDQUFDLEtBQWEsRUFBRSxRQUFrQjtRQUN6QyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVPLFdBQVcsQ0FBQyxLQUFVLEVBQUUsV0FBbUI7UUFDL0MsRUFBRSxDQUFDLENBQUMsU0FBUyxJQUFJ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QyxDQUFDLE9BQU8sRUFBRSxNQUFNO1lBQzFFLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLDhCQUE4QixFQUFFLE1BQU0sRUFBRSxDQUFDLEtBQVUsRUFBRSxNQUFXO2dCQUNqRixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSw4QkFBOEIsQ0FBQyxDQUFBO2dCQUN2RCxPQUFPLENBQUMsTUFBNkMsQ0FBQyxDQUFBO1lBQzFELENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0NBRUo7QUFFRCxrQkFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBFdmVudEVtaXR0ZXIgZnJvbSAnZXZlbnRzJ1xuaW1wb3J0IERlYnVnZ2VyRXJyb3IgZnJvbSAnLi9EZWJ1Z2dlckVycm9yJ1xuaW1wb3J0IERPTSBmcm9tICcuL0RPTSdcblxuZGVjbGFyZSBpbnRlcmZhY2UgTGF5ZXJUcmVlIHtcblxuICAgIC8qKiBObyBkZXNjcmlwdGlvbiAqL1xuICAgIG9uKGV2ZW50OiAnbGF5ZXJUcmVlRGlkQ2hhbmdlJywgbGlzdGVuZXI6IChwYXJhbXM6IExheWVyVHJlZS5FdmVudFBhcmFtcy5sYXllclRyZWVEaWRDaGFuZ2UpID0+IHZvaWQpOiB2b2lkXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb25jZShldmVudDogJ2xheWVyVHJlZURpZENoYW5nZScsIGxpc3RlbmVyOiAocGFyYW1zOiBMYXllclRyZWUuRXZlbnRQYXJhbXMubGF5ZXJUcmVlRGlkQ2hhbmdlKSA9PiB2b2lkKTogdm9pZFxuXG4gICAgLyoqIE5vIGRlc2NyaXB0aW9uICovXG4gICAgb24oZXZlbnQ6ICdsYXllclBhaW50ZWQnLCBsaXN0ZW5lcjogKHBhcmFtczogTGF5ZXJUcmVlLkV2ZW50UGFyYW1zLmxheWVyUGFpbnRlZCkgPT4gdm9pZCk6IHZvaWRcbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBvbmNlKGV2ZW50OiAnbGF5ZXJQYWludGVkJywgbGlzdGVuZXI6IChwYXJhbXM6IExheWVyVHJlZS5FdmVudFBhcmFtcy5sYXllclBhaW50ZWQpID0+IHZvaWQpOiB2b2lkXG5cbn1cblxubW9kdWxlIExheWVyVHJlZSB7XG4gICAgLyoqKioqKioqKioqKioqKlxuICAgICAqKioqIFR5cGVzICoqKipcbiAgICAgKioqKioqKioqKioqKiovXG5cbiAgICAvKipcbiAgICAgKiBVbmlxdWUgTGF5ZXIgaWRlbnRpZmllci5cbiAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICovXG4gICAgZXhwb3J0IHR5cGUgTGF5ZXJJZCA9IHN0cmluZ1xuXG4gICAgLyoqXG4gICAgICogVW5pcXVlIHNuYXBzaG90IGlkZW50aWZpZXIuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIFNuYXBzaG90SWQgPSBzdHJpbmdcblxuICAgIC8qKlxuICAgICAqIFJlY3RhbmdsZSB3aGVyZSBzY3JvbGxpbmcgaGFwcGVucyBvbiB0aGUgbWFpbiB0aHJlYWQuXG4gICAgICogQGV4cGVyaW1lbnRhbFxuICAgICAqL1xuICAgIGV4cG9ydCB0eXBlIFNjcm9sbFJlY3QgPSB7XG4gICAgICAgIC8qKiBSZWN0YW5nbGUgaXRzZWxmLiAqL1xuICAgICAgICByZWN0OiBET00uUmVjdFxuXG4gICAgICAgIC8qKiBSZWFzb24gZm9yIHJlY3RhbmdsZSB0byBmb3JjZSBzY3JvbGxpbmcgb24gdGhlIG1haW4gdGhyZWFkICovXG4gICAgICAgIHR5cGU6ICdSZXBhaW50c09uU2Nyb2xsJyB8ICdUb3VjaEV2ZW50SGFuZGxlcicgfCAnV2hlZWxFdmVudEhhbmRsZXInXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VyaWFsaXplZCBmcmFnbWVudCBvZiBsYXllciBwaWN0dXJlIGFsb25nIHdpdGggaXRzIG9mZnNldCB3aXRoaW4gdGhlIGxheWVyLlxuICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgKi9cbiAgICBleHBvcnQgdHlwZSBQaWN0dXJlVGlsZSA9IHtcbiAgICAgICAgLyoqIE9mZnNldCBmcm9tIG93bmluZyBsYXllciBsZWZ0IGJvdW5kYXJ5ICovXG4gICAgICAgIHg6IG51bWJlclxuXG4gICAgICAgIC8qKiBPZmZzZXQgZnJvbSBvd25pbmcgbGF5ZXIgdG9wIGJvdW5kYXJ5ICovXG4gICAgICAgIHk6IG51bWJlclxuXG4gICAgICAgIC8qKiBCYXNlNjQtZW5jb2RlZCBzbmFwc2hvdCBkYXRhLiAqL1xuICAgICAgICBwaWN0dXJlOiBzdHJpbmdcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBJbmZvcm1hdGlvbiBhYm91dCBhIGNvbXBvc2l0aW5nIGxheWVyLlxuICAgICAqIEBleHBlcmltZW50YWxcbiAgICAgKi9cbiAgICBleHBvcnQgdHlwZSBMYXllciA9IHtcbiAgICAgICAgLyoqIFRoZSB1bmlxdWUgaWQgZm9yIHRoaXMgbGF5ZXIuICovXG4gICAgICAgIGxheWVySWQ6IExheWVySWRcblxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGlkIG9mIHBhcmVudCAobm90IHByZXNlbnQgZm9yIHJvb3QpLlxuICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICovXG4gICAgICAgIHBhcmVudExheWVySWQ/OiBMYXllcklkXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBiYWNrZW5kIGlkIGZvciB0aGUgbm9kZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBsYXllci5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBiYWNrZW5kTm9kZUlkPzogRE9NLkJhY2tlbmROb2RlSWRcblxuICAgICAgICAvKiogT2Zmc2V0IGZyb20gcGFyZW50IGxheWVyLCBYIGNvb3JkaW5hdGUuICovXG4gICAgICAgIG9mZnNldFg6IG51bWJlclxuXG4gICAgICAgIC8qKiBPZmZzZXQgZnJvbSBwYXJlbnQgbGF5ZXIsIFkgY29vcmRpbmF0ZS4gKi9cbiAgICAgICAgb2Zmc2V0WTogbnVtYmVyXG5cbiAgICAgICAgLyoqIExheWVyIHdpZHRoLiAqL1xuICAgICAgICB3aWR0aDogbnVtYmVyXG5cbiAgICAgICAgLyoqIExheWVyIGhlaWdodC4gKi9cbiAgICAgICAgaGVpZ2h0OiBudW1iZXJcblxuICAgICAgICAvKipcbiAgICAgICAgICogVHJhbnNmb3JtYXRpb24gbWF0cml4IGZvciBsYXllciwgZGVmYXVsdCBpcyBpZGVudGl0eSBtYXRyaXhcbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICB0cmFuc2Zvcm0/OiBudW1iZXJbXVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcmFuc2Zvcm0gYW5jaG9yIHBvaW50IFgsIGFic2VudCBpZiBubyB0cmFuc2Zvcm0gc3BlY2lmaWVkXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgYW5jaG9yWD86IG51bWJlclxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcmFuc2Zvcm0gYW5jaG9yIHBvaW50IFksIGFic2VudCBpZiBubyB0cmFuc2Zvcm0gc3BlY2lmaWVkXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgYW5jaG9yWT86IG51bWJlclxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcmFuc2Zvcm0gYW5jaG9yIHBvaW50IFosIGFic2VudCBpZiBubyB0cmFuc2Zvcm0gc3BlY2lmaWVkXG4gICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgKi9cbiAgICAgICAgYW5jaG9yWj86IG51bWJlclxuXG4gICAgICAgIC8qKiBJbmRpY2F0ZXMgaG93IG1hbnkgdGltZSB0aGlzIGxheWVyIGhhcyBwYWludGVkLiAqL1xuICAgICAgICBwYWludENvdW50OiBudW1iZXJcblxuICAgICAgICAvKiogSW5kaWNhdGVzIHdoZXRoZXIgdGhpcyBsYXllciBob3N0cyBhbnkgY29udGVudCwgcmF0aGVyIHRoYW4gYmVpbmcgdXNlZCBmb3IgdHJhbnNmb3JtL3Njcm9sbGluZyBwdXJwb3NlcyBvbmx5LiAqL1xuICAgICAgICBkcmF3c0NvbnRlbnQ6IGJvb2xlYW5cblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IGlmIGxheWVyIGlzIG5vdCB2aXNpYmxlLlxuICAgICAgICAgKiBAb3B0aW9uYWxcbiAgICAgICAgICovXG4gICAgICAgIGludmlzaWJsZT86IGJvb2xlYW5cblxuICAgICAgICAvKipcbiAgICAgICAgICogUmVjdGFuZ2xlcyBzY3JvbGxpbmcgb24gbWFpbiB0aHJlYWQgb25seS5cbiAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAqL1xuICAgICAgICBzY3JvbGxSZWN0cz86IFNjcm9sbFJlY3RbXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFycmF5IG9mIHRpbWluZ3MsIG9uZSBwZXIgcGFpbnQgc3RlcC5cbiAgICAgKiBAZXhwZXJpbWVudGFsXG4gICAgICovXG4gICAgZXhwb3J0IHR5cGUgUGFpbnRQcm9maWxlID0gbnVtYmVyW11cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAgICoqKiogQ29tbWFuZCBQYXJhbWV0ZXJzICoqKipcbiAgICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUGFyYW1zIHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgY29tcG9zaXRpbmdSZWFzb25zID0ge1xuICAgICAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgbGF5ZXIgZm9yIHdoaWNoIHdlIHdhbnQgdG8gZ2V0IHRoZSByZWFzb25zIGl0IHdhcyBjb21wb3NpdGVkLiAqL1xuICAgICAgICAgICAgbGF5ZXJJZDogTGF5ZXJJZFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgbWFrZVNuYXBzaG90ID0ge1xuICAgICAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgbGF5ZXIuICovXG4gICAgICAgICAgICBsYXllcklkOiBMYXllcklkXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBsb2FkU25hcHNob3QgPSB7XG4gICAgICAgICAgICAvKiogQW4gYXJyYXkgb2YgdGlsZXMgY29tcG9zaW5nIHRoZSBzbmFwc2hvdC4gKi9cbiAgICAgICAgICAgIHRpbGVzOiBQaWN0dXJlVGlsZVtdXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSByZWxlYXNlU25hcHNob3QgPSB7XG4gICAgICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBsYXllciBzbmFwc2hvdC4gKi9cbiAgICAgICAgICAgIHNuYXBzaG90SWQ6IFNuYXBzaG90SWRcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHByb2ZpbGVTbmFwc2hvdCA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGxheWVyIHNuYXBzaG90LiAqL1xuICAgICAgICAgICAgc25hcHNob3RJZDogU25hcHNob3RJZFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB0aW1lcyB0byByZXBsYXkgdGhlIHNuYXBzaG90ICgxLCBpZiBub3Qgc3BlY2lmaWVkKS5cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBtaW5SZXBlYXRDb3VudD86IG51bWJlclxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBtaW5pbXVtIGR1cmF0aW9uIChpbiBzZWNvbmRzKSB0byByZXBsYXkgdGhlIHNuYXBzaG90LlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1pbkR1cmF0aW9uPzogbnVtYmVyXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogVGhlIGNsaXAgcmVjdGFuZ2xlIHRvIGFwcGx5IHdoZW4gcmVwbGF5aW5nIHRoZSBzbmFwc2hvdC5cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjbGlwUmVjdD86IERPTS5SZWN0XG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSByZXBsYXlTbmFwc2hvdCA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIGxheWVyIHNuYXBzaG90LiAqL1xuICAgICAgICAgICAgc25hcHNob3RJZDogU25hcHNob3RJZFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBmaXJzdCBzdGVwIHRvIHJlcGxheSBmcm9tIChyZXBsYXkgZnJvbSB0aGUgdmVyeSBzdGFydCBpZiBub3Qgc3BlY2lmaWVkKS5cbiAgICAgICAgICAgICAqIEBvcHRpb25hbFxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBmcm9tU3RlcD86IG51bWJlclxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBsYXN0IHN0ZXAgdG8gcmVwbGF5IHRvIChyZXBsYXkgdGlsbCB0aGUgZW5kIGlmIG5vdCBzcGVjaWZpZWQpLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRvU3RlcD86IG51bWJlclxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIFRoZSBzY2FsZSB0byBhcHBseSB3aGlsZSByZXBsYXlpbmcgKGRlZmF1bHRzIHRvIDEpLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHNjYWxlPzogbnVtYmVyXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBzbmFwc2hvdENvbW1hbmRMb2cgPSB7XG4gICAgICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBsYXllciBzbmFwc2hvdC4gKi9cbiAgICAgICAgICAgIHNuYXBzaG90SWQ6IFNuYXBzaG90SWRcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKipcbiAgICAgKioqKiBDb21tYW5kIFJlc3VsdCAqKioqXG4gICAgICoqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgUmVzdWx0IHtcbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgY29tcG9zaXRpbmdSZWFzb25zID0ge1xuICAgICAgICAgICAgLyoqIEEgbGlzdCBvZiBzdHJpbmdzIHNwZWNpZnlpbmcgcmVhc29ucyBmb3IgdGhlIGdpdmVuIGxheWVyIHRvIGJlY29tZSBjb21wb3NpdGVkLiAqL1xuICAgICAgICAgICAgY29tcG9zaXRpbmdSZWFzb25zOiBzdHJpbmdbXVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIEBleHBlcmltZW50YWwgKi9cbiAgICAgICAgZXhwb3J0IHR5cGUgbWFrZVNuYXBzaG90ID0ge1xuICAgICAgICAgICAgLyoqIFRoZSBpZCBvZiB0aGUgbGF5ZXIgc25hcHNob3QuICovXG4gICAgICAgICAgICBzbmFwc2hvdElkOiBTbmFwc2hvdElkXG4gICAgICAgIH1cblxuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBsb2FkU25hcHNob3QgPSB7XG4gICAgICAgICAgICAvKiogVGhlIGlkIG9mIHRoZSBzbmFwc2hvdC4gKi9cbiAgICAgICAgICAgIHNuYXBzaG90SWQ6IFNuYXBzaG90SWRcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHByb2ZpbGVTbmFwc2hvdCA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgYXJyYXkgb2YgcGFpbnQgcHJvZmlsZXMsIG9uZSBwZXIgcnVuLiAqL1xuICAgICAgICAgICAgdGltaW5nczogUGFpbnRQcm9maWxlW11cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHJlcGxheVNuYXBzaG90ID0ge1xuICAgICAgICAgICAgLyoqIEEgZGF0YTogVVJMIGZvciByZXN1bHRpbmcgaW1hZ2UuICovXG4gICAgICAgICAgICBkYXRhVVJMOiBzdHJpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIHNuYXBzaG90Q29tbWFuZExvZyA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgYXJyYXkgb2YgY2FudmFzIGZ1bmN0aW9uIGNhbGxzLiAqL1xuICAgICAgICAgICAgY29tbWFuZExvZzogb2JqZWN0W11cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgICAqKioqIEV2ZW50IFBhcmFtZXRlcnMgKioqKlxuICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqL1xuICAgIGV4cG9ydCBtb2R1bGUgRXZlbnRQYXJhbXMge1xuICAgICAgICAvKiogQGV4cGVyaW1lbnRhbCAqL1xuICAgICAgICBleHBvcnQgdHlwZSBsYXllclRyZWVEaWRDaGFuZ2UgPSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIExheWVyIHRyZWUsIGFic2VudCBpZiBub3QgaW4gdGhlIGNvbXNwb3NpdGluZyBtb2RlLlxuICAgICAgICAgICAgICogQG9wdGlvbmFsXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGxheWVycz86IExheWVyW11cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBAZXhwZXJpbWVudGFsICovXG4gICAgICAgIGV4cG9ydCB0eXBlIGxheWVyUGFpbnRlZCA9IHtcbiAgICAgICAgICAgIC8qKiBUaGUgaWQgb2YgdGhlIHBhaW50ZWQgbGF5ZXIuICovXG4gICAgICAgICAgICBsYXllcklkOiBMYXllcklkXG5cbiAgICAgICAgICAgIC8qKiBDbGlwIHJlY3RhbmdsZS4gKi9cbiAgICAgICAgICAgIGNsaXA6IERPTS5SZWN0XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogTm8gZGVzY3JpcHRpb25cbiAqIEBleHBlcmltZW50YWxcbiAqL1xuY2xhc3MgTGF5ZXJUcmVlIHtcbiAgICBwcml2YXRlIGV2ZW50cyA9IG5ldyBFdmVudEVtaXR0ZXIoKVxuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkYmc6IGFueSAvKiBFbGVjdHJvbi5EZWJ1Z2dlciovICkge1xuXG4gICAgICAgIHRoaXMuZGJnLm9uKCdtZXNzYWdlJywgKGV2ZW50OiBhbnksIG1ldGhvZDogYW55LCBwYXJhbXM6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2RvbWFpbiwgZG9tYWluTWV0aG9kXSA9IG1ldGhvZC5zcGxpdCgnLicpXG4gICAgICAgICAgICB0aGlzLmV2ZW50cy5lbWl0KGRvbWFpbk1ldGhvZCwgcGFyYW1zKVxuICAgICAgICB9KVxuXG4gICAgICAgIGlmICghdGhpcy5kYmcuaXNBdHRhY2hlZCgpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjcmVhdGUgTGF5ZXJUcmVlIERvbWFpbiBDbGFzcyBiZWNhdXNlIHRoZSBkZWJ1Z2dlciBpcyBub3QgYXR0YWNoZWQuYClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBvbihldmVudDogc3RyaW5nLCBsaXN0ZW5lcjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy5ldmVudHMub24oZXZlbnQsIGxpc3RlbmVyKVxuICAgIH1cblxuICAgIHB1YmxpYyBvbmNlKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBGdW5jdGlvbikge1xuICAgICAgICB0aGlzLmV2ZW50cy5vbihldmVudCwgbGlzdGVuZXIpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3NlcnRFcnJvcihlcnJvcjogYW55LCBjb21tYW5kTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIGlmICgnbWVzc2FnZScgaW4gZXJyb3IgJiYgJ2NvZGUnIGluIGVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRGVidWdnZXJFcnJvcihlcnJvci5tZXNzYWdlLCBlcnJvci5jb2RlLCBjb21tYW5kTmFtZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBFbmFibGVzIGNvbXBvc2l0aW5nIHRyZWUgaW5zcGVjdGlvbi4gKi9cbiAgICBwdWJsaWMgYXN5bmMgZW5hYmxlKCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0xheWVyVHJlZS5lbmFibGUnLCB7fSwgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0xheWVyVHJlZS5lbmFibGUnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogRGlzYWJsZXMgY29tcG9zaXRpbmcgdHJlZSBpbnNwZWN0aW9uLiAqL1xuICAgIHB1YmxpYyBhc3luYyBkaXNhYmxlKCk6IFByb21pc2U8dW5kZWZpbmVkPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPHVuZGVmaW5lZD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kYmcuc2VuZENvbW1hbmQoJ0xheWVyVHJlZS5kaXNhYmxlJywge30sIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXNzZXJ0RXJyb3IoZXJyb3IsICdMYXllclRyZWUuZGlzYWJsZScpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBQcm92aWRlcyB0aGUgcmVhc29ucyB3aHkgdGhlIGdpdmVuIGxheWVyIHdhcyBjb21wb3NpdGVkLiAqL1xuICAgIHB1YmxpYyBhc3luYyBjb21wb3NpdGluZ1JlYXNvbnMocGFyYW1zOiBMYXllclRyZWUuUGFyYW1zLmNvbXBvc2l0aW5nUmVhc29ucyk6IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5jb21wb3NpdGluZ1JlYXNvbnM+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5jb21wb3NpdGluZ1JlYXNvbnM+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdMYXllclRyZWUuY29tcG9zaXRpbmdSZWFzb25zJywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnTGF5ZXJUcmVlLmNvbXBvc2l0aW5nUmVhc29ucycpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgTGF5ZXJUcmVlLlJlc3VsdC5jb21wb3NpdGluZ1JlYXNvbnMpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIHRoZSBsYXllciBzbmFwc2hvdCBpZGVudGlmaWVyLiAqL1xuICAgIHB1YmxpYyBhc3luYyBtYWtlU25hcHNob3QocGFyYW1zOiBMYXllclRyZWUuUGFyYW1zLm1ha2VTbmFwc2hvdCk6IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5tYWtlU25hcHNob3Q+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5tYWtlU25hcHNob3Q+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdMYXllclRyZWUubWFrZVNuYXBzaG90JywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnTGF5ZXJUcmVlLm1ha2VTbmFwc2hvdCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgTGF5ZXJUcmVlLlJlc3VsdC5tYWtlU25hcHNob3QpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIHRoZSBzbmFwc2hvdCBpZGVudGlmaWVyLiAqL1xuICAgIHB1YmxpYyBhc3luYyBsb2FkU25hcHNob3QocGFyYW1zOiBMYXllclRyZWUuUGFyYW1zLmxvYWRTbmFwc2hvdCk6IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5sb2FkU25hcHNob3Q+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5sb2FkU25hcHNob3Q+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGJnLnNlbmRDb21tYW5kKCdMYXllclRyZWUubG9hZFNuYXBzaG90JywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnTGF5ZXJUcmVlLmxvYWRTbmFwc2hvdCcpXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQgYXMgTGF5ZXJUcmVlLlJlc3VsdC5sb2FkU25hcHNob3QpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKiBSZWxlYXNlcyBsYXllciBzbmFwc2hvdCBjYXB0dXJlZCBieSB0aGUgYmFjay1lbmQuICovXG4gICAgcHVibGljIGFzeW5jIHJlbGVhc2VTbmFwc2hvdChwYXJhbXM6IExheWVyVHJlZS5QYXJhbXMucmVsZWFzZVNuYXBzaG90KTogUHJvbWlzZTx1bmRlZmluZWQ+e1xuICAgICAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dW5kZWZpbmVkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnTGF5ZXJUcmVlLnJlbGVhc2VTbmFwc2hvdCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0xheWVyVHJlZS5yZWxlYXNlU25hcHNob3QnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogTm8gZGVzY3JpcHRpb24gKi9cbiAgICBwdWJsaWMgYXN5bmMgcHJvZmlsZVNuYXBzaG90KHBhcmFtczogTGF5ZXJUcmVlLlBhcmFtcy5wcm9maWxlU25hcHNob3QpOiBQcm9taXNlPExheWVyVHJlZS5SZXN1bHQucHJvZmlsZVNuYXBzaG90PntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPExheWVyVHJlZS5SZXN1bHQucHJvZmlsZVNuYXBzaG90PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnTGF5ZXJUcmVlLnByb2ZpbGVTbmFwc2hvdCcsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0xheWVyVHJlZS5wcm9maWxlU25hcHNob3QnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0IGFzIExheWVyVHJlZS5SZXN1bHQucHJvZmlsZVNuYXBzaG90KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogUmVwbGF5cyB0aGUgbGF5ZXIgc25hcHNob3QgYW5kIHJldHVybnMgdGhlIHJlc3VsdGluZyBiaXRtYXAuICovXG4gICAgcHVibGljIGFzeW5jIHJlcGxheVNuYXBzaG90KHBhcmFtczogTGF5ZXJUcmVlLlBhcmFtcy5yZXBsYXlTbmFwc2hvdCk6IFByb21pc2U8TGF5ZXJUcmVlLlJlc3VsdC5yZXBsYXlTbmFwc2hvdD57XG4gICAgICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTxMYXllclRyZWUuUmVzdWx0LnJlcGxheVNuYXBzaG90PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnTGF5ZXJUcmVlLnJlcGxheVNuYXBzaG90JywgcGFyYW1zLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmFzc2VydEVycm9yKGVycm9yLCAnTGF5ZXJUcmVlLnJlcGxheVNuYXBzaG90JylcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCBhcyBMYXllclRyZWUuUmVzdWx0LnJlcGxheVNuYXBzaG90KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogUmVwbGF5cyB0aGUgbGF5ZXIgc25hcHNob3QgYW5kIHJldHVybnMgY2FudmFzIGxvZy4gKi9cbiAgICBwdWJsaWMgYXN5bmMgc25hcHNob3RDb21tYW5kTG9nKHBhcmFtczogTGF5ZXJUcmVlLlBhcmFtcy5zbmFwc2hvdENvbW1hbmRMb2cpOiBQcm9taXNlPExheWVyVHJlZS5SZXN1bHQuc25hcHNob3RDb21tYW5kTG9nPntcbiAgICAgICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlPExheWVyVHJlZS5SZXN1bHQuc25hcHNob3RDb21tYW5kTG9nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRiZy5zZW5kQ29tbWFuZCgnTGF5ZXJUcmVlLnNuYXBzaG90Q29tbWFuZExvZycsIHBhcmFtcywgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hc3NlcnRFcnJvcihlcnJvciwgJ0xheWVyVHJlZS5zbmFwc2hvdENvbW1hbmRMb2cnKVxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzdWx0IGFzIExheWVyVHJlZS5SZXN1bHQuc25hcHNob3RDb21tYW5kTG9nKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGF5ZXJUcmVlIl19